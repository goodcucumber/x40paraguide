<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>ç¬¬ 1 ç«  SIMD å’Œ SSE/AVX | x40å¹¶è¡Œç¼–ç¨‹æŒ‡å—</title>
  <meta name="description" content="åœ¨x40æœåŠ¡å™¨ä¸Šå¹¶è¡Œè¿ç®—" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="ç¬¬ 1 ç«  SIMD å’Œ SSE/AVX | x40å¹¶è¡Œç¼–ç¨‹æŒ‡å—" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="åœ¨x40æœåŠ¡å™¨ä¸Šå¹¶è¡Œè¿ç®—" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="ç¬¬ 1 ç«  SIMD å’Œ SSE/AVX | x40å¹¶è¡Œç¼–ç¨‹æŒ‡å—" />
  
  <meta name="twitter:description" content="åœ¨x40æœåŠ¡å™¨ä¸Šå¹¶è¡Œè¿ç®—" />
  

<meta name="author" content="cucumber" />


<meta name="date" content="2020-09-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="part1.html"/>
<link rel="next" href="cmt.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css\style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">x40å¹¶è¡Œç¼–ç¨‹æŒ‡å—</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>å‰è¨€</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#è‡´è°¢"><i class="fa fa-check"></i>è‡´è°¢</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html"><i class="fa fa-check"></i>ä½œè€…ç®€ä»‹</a></li>
<li class="chapter" data-level="" data-path="x40.html"><a href="x40.html"><i class="fa fa-check"></i>x40æœåŠ¡å™¨</a></li>
<li class="part"><span><b>I cè¯­è¨€å¹¶è¡Œç¼–ç¨‹</b></span></li>
<li class="chapter" data-level="" data-path="part1.html"><a href="part1.html"><i class="fa fa-check"></i>ç¬¬ä¸€éƒ¨åˆ†</a></li>
<li class="chapter" data-level="1" data-path="csimd.html"><a href="csimd.html"><i class="fa fa-check"></i><b>1</b> SIMD å’Œ SSE/AVX</a><ul>
<li class="chapter" data-level="1.1" data-path="csimd.html"><a href="csimd.html#muladd_base"><i class="fa fa-check"></i><b>1.1</b> ä¸€ä¸ªç®€å•çš„ç¨‹åº</a></li>
<li class="chapter" data-level="1.2" data-path="csimd.html"><a href="csimd.html#csimd_first"><i class="fa fa-check"></i><b>1.2</b> æˆ‘çš„ç¬¬ä¸€ä¸ªSIMDç¨‹åºï¼</a></li>
<li class="chapter" data-level="1.3" data-path="csimd.html"><a href="csimd.html#csimd_reg"><i class="fa fa-check"></i><b>1.3</b> æä¸ªå¯„å­˜å™¨å˜é‡</a></li>
<li class="chapter" data-level="1.4" data-path="csimd.html"><a href="csimd.html#csimd_asm"><i class="fa fa-check"></i><b>1.4</b> æˆ‘æ¯”ç¼–è¯‘å™¨èªæ˜ç³»åˆ—</a></li>
<li class="chapter" data-level="1.5" data-path="csimd.html"><a href="csimd.html#csimd_gccO3"><i class="fa fa-check"></i><b>1.5</b> ç¼–è¯‘å™¨æ¯”æˆ‘èªæ˜ç³»åˆ—</a></li>
<li class="chapter" data-level="1.6" data-path="csimd.html"><a href="csimd.html#csimd_sum"><i class="fa fa-check"></i><b>1.6</b> æœ¬ç« å°ç»“</a></li>
<li class="chapter" data-level="1.7" data-path="csimd.html"><a href="csimd.html#csimd_add"><i class="fa fa-check"></i><b>1.7</b> è¡¥å……å†…å®¹</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cmt.html"><a href="cmt.html"><i class="fa fa-check"></i><b>2</b> cè¯­è¨€å¤šçº¿ç¨‹ç¼–ç¨‹</a><ul>
<li class="chapter" data-level="2.1" data-path="cmt.html"><a href="cmt.html#cmt_muladd"><i class="fa fa-check"></i><b>2.1</b> è¿˜æ˜¯ä¹˜åŠ è¿ç®—</a></li>
<li class="chapter" data-level="2.2" data-path="cmt.html"><a href="cmt.html#cmt_sum"><i class="fa fa-check"></i><b>2.2</b> æœ¬ç« å°ç»“</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="fma.html"><a href="fma.html"><i class="fa fa-check"></i><b>3</b> ç¬¬ä¸€éƒ¨åˆ†ç»“æŸè¯­</a></li>
<li class="part"><span><b>II GPGPU</b></span></li>
<li class="chapter" data-level="" data-path="part2.html"><a href="part2.html"><i class="fa fa-check"></i>ç¬¬äºŒéƒ¨åˆ†</a></li>
<li class="chapter" data-level="4" data-path="gpuintro.html"><a href="gpuintro.html"><i class="fa fa-check"></i><b>4</b> GPUç®€ä»‹</a><ul>
<li class="chapter" data-level="4.1" data-path="gpuintro.html"><a href="gpuintro.html#gpu_about"><i class="fa fa-check"></i><b>4.1</b> å›¾å½¢å¤„ç†æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ</a></li>
<li class="chapter" data-level="4.2" data-path="gpuintro.html"><a href="gpuintro.html#gpu_gpgpu"><i class="fa fa-check"></i><b>4.2</b> é‚£GPGPUæ˜¯å•¥ï¼Ÿ</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="cuda.html"><a href="cuda.html"><i class="fa fa-check"></i><b>5</b> CUDA</a><ul>
<li class="chapter" data-level="5.1" data-path="cuda.html"><a href="cuda.html#before_start"><i class="fa fa-check"></i><b>5.1</b> å¼€å§‹ä¹‹å‰</a></li>
<li class="chapter" data-level="5.2" data-path="cuda.html"><a href="cuda.html#cuda_first"><i class="fa fa-check"></i><b>5.2</b> æˆ‘çš„ç¬¬ä¸€ä¸ªcudaç¨‹åº</a><ul>
<li class="chapter" data-level="5.2.1" data-path="cuda.html"><a href="cuda.html#include-cuda_runtime.h"><i class="fa fa-check"></i><b>5.2.1</b> #include &lt;cuda_runtime.h&gt;</a></li>
<li class="chapter" data-level="5.2.2" data-path="cuda.html"><a href="cuda.html#global__-void-muladd"><i class="fa fa-check"></i><b>5.2.2</b> <code>__global__ void muladd</code></a></li>
<li class="chapter" data-level="5.2.3" data-path="cuda.html"><a href="cuda.html#blockidxblockdimå’Œthreadidx"><i class="fa fa-check"></i><b>5.2.3</b> <code>blockIdx</code>,<code>blockDim</code>å’Œ<code>threadIdx</code></a></li>
<li class="chapter" data-level="5.2.4" data-path="cuda.html"><a href="cuda.html#cudamalloc"><i class="fa fa-check"></i><b>5.2.4</b> <code>cudaMalloc</code></a></li>
<li class="chapter" data-level="5.2.5" data-path="cuda.html"><a href="cuda.html#cudamemcpy"><i class="fa fa-check"></i><b>5.2.5</b> <code>cudaMemcpy</code></a></li>
<li class="chapter" data-level="5.2.6" data-path="cuda.html"><a href="cuda.html#section"><i class="fa fa-check"></i><b>5.2.6</b> <code>&lt;&lt;&lt;32, 256&gt;&gt;&gt;</code></a></li>
<li class="chapter" data-level="5.2.7" data-path="cuda.html"><a href="cuda.html#cudafree"><i class="fa fa-check"></i><b>5.2.7</b> <code>cudaFree</code></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="cuda.html"><a href="cuda.html#cudaæ–°å¢ç±»å‹"><i class="fa fa-check"></i><b>5.3</b> CUDAæ–°å¢ç±»å‹</a></li>
<li class="chapter" data-level="5.4" data-path="cuda.html"><a href="cuda.html#cuda_device"><i class="fa fa-check"></i><b>5.4</b> ä½¿ç”¨<code>__device__</code>å‡½æ•°</a></li>
<li class="chapter" data-level="5.5" data-path="cuda.html"><a href="cuda.html#cuda_shared"><i class="fa fa-check"></i><b>5.5</b> ç”ŸæˆåŠ¨æ€é“¾æ¥åº“</a><ul>
<li class="chapter" data-level="5.5.1" data-path="cuda.html"><a href="cuda.html#ç”¨cåšä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“"><i class="fa fa-check"></i><b>5.5.1</b> ç”¨c++åšä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“</a></li>
<li class="chapter" data-level="5.5.2" data-path="cuda.html"><a href="cuda.html#ç”Ÿæˆcudaçš„åŠ¨æ€é“¾æ¥åº“"><i class="fa fa-check"></i><b>5.5.2</b> ç”Ÿæˆcudaçš„åŠ¨æ€é“¾æ¥åº“</a></li>
<li class="chapter" data-level="5.5.3" data-path="cuda.html"><a href="cuda.html#ä½¿ç”¨åŠ¨æ€é“¾æ¥åº“"><i class="fa fa-check"></i><b>5.5.3</b> ä½¿ç”¨åŠ¨æ€é“¾æ¥åº“</a></li>
<li class="chapter" data-level="5.5.4" data-path="cuda.html"><a href="cuda.html#åœ¨rootä¸­äº¤äº’åœ°ä½¿ç”¨åŠ¨æ€é“¾æ¥åº“"><i class="fa fa-check"></i><b>5.5.4</b> åœ¨rootä¸­äº¤äº’åœ°ä½¿ç”¨åŠ¨æ€é“¾æ¥åº“</a></li>
<li class="chapter" data-level="5.5.5" data-path="cuda.html"><a href="cuda.html#åœ¨rootä¸­äº¤äº’åœ°ä½¿ç”¨cudaçš„å®Œæ•´ä¾‹å­"><i class="fa fa-check"></i><b>5.5.5</b> åœ¨rootä¸­äº¤äº’åœ°ä½¿ç”¨cudaçš„å®Œæ•´ä¾‹å­</a></li>
<li class="chapter" data-level="5.5.6" data-path="cuda.html"><a href="cuda.html#ä¸æ”¯æŒcçš„æƒ…å†µ"><i class="fa fa-check"></i><b>5.5.6</b> ä¸æ”¯æŒc++çš„æƒ…å†µ</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="cuda.html"><a href="cuda.html#cudabase_sum"><i class="fa fa-check"></i><b>5.6</b> æœ¬ç« å°ç»“</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="cuda-adv.html"><a href="cuda-adv.html"><i class="fa fa-check"></i><b>6</b> CUDAé«˜çº§ä¼˜åŒ–æŠ€å·§</a><ul>
<li class="chapter" data-level="6.1" data-path="cuda-adv.html"><a href="cuda-adv.html#çº¹ç†å’Œçº¹ç†å†…å­˜"><i class="fa fa-check"></i><b>6.1</b> çº¹ç†å’Œçº¹ç†å†…å­˜</a><ul>
<li class="chapter" data-level="6.1.1" data-path="cuda-adv.html"><a href="cuda-adv.html#ä»€ä¹ˆæ˜¯çº¹ç†"><i class="fa fa-check"></i><b>6.1.1</b> ä»€ä¹ˆæ˜¯çº¹ç†ï¼Ÿ</a></li>
<li class="chapter" data-level="6.1.2" data-path="cuda-adv.html"><a href="cuda-adv.html#cudaçº¹ç†çš„å¯»å€æ¨¡å¼å’Œçº¿æ€§æ’å€¼"><i class="fa fa-check"></i><b>6.1.2</b> CUDAçº¹ç†çš„å¯»å€æ¨¡å¼å’Œçº¿æ€§æ’å€¼</a></li>
<li class="chapter" data-level="6.1.3" data-path="cuda-adv.html"><a href="cuda-adv.html#ä¸¾ä¸€ä¸ªä¾‹å­"><i class="fa fa-check"></i><b>6.1.3</b> ä¸¾ä¸€ä¸ªä¾‹å­</a></li>
<li class="chapter" data-level="6.1.4" data-path="cuda-adv.html"><a href="cuda-adv.html#å¦‚ä½•å®ç°åŒç²¾åº¦çº¹ç†"><i class="fa fa-check"></i><b>6.1.4</b> å¦‚ä½•å®ç°åŒç²¾åº¦çº¹ç†</a></li>
<li class="chapter" data-level="6.1.5" data-path="cuda-adv.html"><a href="cuda-adv.html#æ‰€ä»¥ä¸ºä»€ä¹ˆè¦ç”¨çº¹ç†"><i class="fa fa-check"></i><b>6.1.5</b> æ‰€ä»¥ä¸ºä»€ä¹ˆè¦ç”¨çº¹ç†ï¼Ÿ</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="cuda-adv.html"><a href="cuda-adv.html#æµ"><i class="fa fa-check"></i><b>6.2</b> æµ</a><ul>
<li class="chapter" data-level="6.2.1" data-path="cuda-adv.html"><a href="cuda-adv.html#ä¸¾ä¸ªä¾‹å­"><i class="fa fa-check"></i><b>6.2.1</b> ä¸¾ä¸ªä¾‹å­</a></li>
<li class="chapter" data-level="6.2.2" data-path="cuda-adv.html"><a href="cuda-adv.html#å›è°ƒ"><i class="fa fa-check"></i><b>6.2.2</b> å›è°ƒ</a></li>
<li class="chapter" data-level="6.2.3" data-path="cuda-adv.html"><a href="cuda-adv.html#ä»€ä¹ˆæ—¶å€™è¦ä½¿ç”¨æµ"><i class="fa fa-check"></i><b>6.2.3</b> ä»€ä¹ˆæ—¶å€™è¦ä½¿ç”¨æµ</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="cuda-adv.html"><a href="cuda-adv.html#ç¼“å­˜å’Œå…±äº«å†…å­˜çš„åˆ†é…"><i class="fa fa-check"></i><b>6.3</b> ç¼“å­˜å’Œå…±äº«å†…å­˜çš„åˆ†é…</a></li>
<li class="chapter" data-level="6.4" data-path="cuda-adv.html"><a href="cuda-adv.html#cuadv_sum"><i class="fa fa-check"></i><b>6.4</b> æœ¬ç« å°ç»“</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="nsight.html"><a href="nsight.html"><i class="fa fa-check"></i><b>7</b> ä½¿ç”¨Nsightä¼˜åŒ–ç¨‹åº</a><ul>
<li class="chapter" data-level="7.1" data-path="nsight.html"><a href="nsight.html#ä¸‹è½½å’Œå®‰è£…"><i class="fa fa-check"></i><b>7.1</b> ä¸‹è½½å’Œå®‰è£…</a></li>
<li class="chapter" data-level="7.2" data-path="nsight.html"><a href="nsight.html#è¿æ¥åˆ°æœåŠ¡å™¨"><i class="fa fa-check"></i><b>7.2</b> è¿æ¥åˆ°æœåŠ¡å™¨</a></li>
<li class="chapter" data-level="7.3" data-path="nsight.html"><a href="nsight.html#åˆ†æç¨‹åº"><i class="fa fa-check"></i><b>7.3</b> åˆ†æç¨‹åº</a></li>
<li class="chapter" data-level="7.4" data-path="nsight.html"><a href="nsight.html#æŸ¥çœ‹æŠ¥å‘Š"><i class="fa fa-check"></i><b>7.4</b> æŸ¥çœ‹æŠ¥å‘Š</a></li>
</ul></li>
<li class="appendix"><span><b>é™„å½•</b></span></li>
<li class="chapter" data-level="A" data-path="assemble.html"><a href="assemble.html"><i class="fa fa-check"></i><b>A</b> æ±‡ç¼–è¯­è¨€ç®€ä»‹</a><ul>
<li class="chapter" data-level="A.1" data-path="assemble.html"><a href="assemble.html#åŸºæœ¬æ“ä½œ"><i class="fa fa-check"></i><b>A.1</b> åŸºæœ¬æ“ä½œ</a></li>
<li class="chapter" data-level="A.2" data-path="assemble.html"><a href="assemble.html#ç¥å¥‡çš„è£…è½½æœ‰æ•ˆåœ°å€"><i class="fa fa-check"></i><b>A.2</b> ç¥å¥‡çš„â€œè£…è½½æœ‰æ•ˆåœ°å€â€</a></li>
<li class="chapter" data-level="A.3" data-path="assemble.html"><a href="assemble.html#cè¯­è¨€ä¸­çš„å†…è”æ±‡ç¼–"><i class="fa fa-check"></i><b>A.3</b> cè¯­è¨€ä¸­çš„å†…è”æ±‡ç¼–</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="float.html"><a href="float.html"><i class="fa fa-check"></i><b>B</b> æµ®ç‚¹æ•°çš„è®¡ç®—æœºè¡¨ç¤º</a><ul>
<li class="chapter" data-level="B.1" data-path="float.html"><a href="float.html#å•ç²¾åº¦æµ®ç‚¹æ•°"><i class="fa fa-check"></i><b>B.1</b> å•ç²¾åº¦æµ®ç‚¹æ•°</a><ul>
<li class="chapter" data-level="B.1.1" data-path="float.html"><a href="float.html#è§„æ ¼åŒ–çš„å•ç²¾åº¦æµ®ç‚¹æ•°"><i class="fa fa-check"></i><b>B.1.1</b> è§„æ ¼åŒ–çš„å•ç²¾åº¦æµ®ç‚¹æ•°</a></li>
<li class="chapter" data-level="B.1.2" data-path="float.html"><a href="float.html#éè§„æ ¼åŒ–çš„å•ç²¾åº¦æµ®ç‚¹æ•°"><i class="fa fa-check"></i><b>B.1.2</b> éè§„æ ¼åŒ–çš„å•ç²¾åº¦æµ®ç‚¹æ•°</a></li>
<li class="chapter" data-level="B.1.3" data-path="float.html"><a href="float.html#ç‰¹æ®Šå€¼"><i class="fa fa-check"></i><b>B.1.3</b> ç‰¹æ®Šå€¼</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="float.html"><a href="float.html#åŒç²¾åº¦æµ®ç‚¹æ•°å’ŒåŠç²¾åº¦æµ®ç‚¹æ•°"><i class="fa fa-check"></i><b>B.2</b> åŒç²¾åº¦æµ®ç‚¹æ•°å’ŒåŠç²¾åº¦æµ®ç‚¹æ•°</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="cache.html"><a href="cache.html"><i class="fa fa-check"></i><b>C</b> é«˜é€Ÿç¼“å­˜</a><ul>
<li class="chapter" data-level="C.1" data-path="cache.html"><a href="cache.html#å±€éƒ¨æ€§åŸç†"><i class="fa fa-check"></i><b>C.1</b> å±€éƒ¨æ€§åŸç†</a></li>
<li class="chapter" data-level="C.2" data-path="cache.html"><a href="cache.html#ç¼“å­˜çš„ç»„æ€"><i class="fa fa-check"></i><b>C.2</b> ç¼“å­˜çš„ç»„æ€</a></li>
<li class="chapter" data-level="C.3" data-path="cache.html"><a href="cache.html#ç¼“å­˜ä¼˜åŒ–"><i class="fa fa-check"></i><b>C.3</b> ç¼“å­˜ä¼˜åŒ–</a></li>
<li class="chapter" data-level="C.4" data-path="cache.html"><a href="cache.html#å¦‚ä½•æŸ¥çœ‹cpuçš„ç¼“å­˜ç»„æ€"><i class="fa fa-check"></i><b>C.4</b> å¦‚ä½•æŸ¥çœ‹cpuçš„ç¼“å­˜ç»„æ€</a></li>
<li class="chapter" data-level="C.5" data-path="cache.html"><a href="cache.html#æ„Ÿå—ä¸€ä¸‹ç¼“å­˜ä¸å‘½ä¸­"><i class="fa fa-check"></i><b>C.5</b> æ„Ÿå—ä¸€ä¸‹ç¼“å­˜ä¸å‘½ä¸­</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>å‚è€ƒæ–‡çŒ®</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">æœ¬ä¹¦ç”± bookdown å¼ºåŠ›é©±åŠ¨</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">x40å¹¶è¡Œç¼–ç¨‹æŒ‡å—</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="csimd" class="section level1">
<h1><span class="header-section-number">ç¬¬ 1 ç« </span> SIMD å’Œ SSE/AVX</h1>
<p>SIMD (Single Instruction, Multiple Data)ï¼Œå³å•æŒ‡ä»¤å¤šæ•°æ®ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯é€šè¿‡ä¸€æ¡æŒ‡ä»¤å¯¹å¤šæ¡æ•°æ®è¿›è¡ŒåŒæ—¶æ“ä½œã€‚æ®ç»´åŸºç™¾ç§‘è¯´ï¼Œæœ€æ—©å¾—åˆ°å¹¿æ³›åº”ç”¨çš„SIMDæŒ‡ä»¤é›†æ˜¯Intelçš„MMXæŒ‡ä»¤é›†ï¼Œå…±åŒ…å«57æ¡æŒ‡ä»¤ã€‚MMXæä¾›äº†8ä¸ª64ä½çš„å¯„å­˜å™¨(MM0 - MM7)ï¼Œæ¯ä¸ªå¯„å­˜å™¨å¯ä»¥å­˜æ”¾ä¸¤ä¸ª32ä½æ•´æ•°æˆ–4ä¸ª16ä½æ•´æ•°æˆ–8ä¸ª8ä½æ•´æ•°ï¼Œå¯„å­˜å™¨ä¸­â€œæ‰“åŒ…â€çš„å¤šä¸ªæ•°æ®å¯ä»¥é€šè¿‡ä¸€æ¡æŒ‡ä»¤åŒæ—¶å¤„ç†ï¼Œä¸å†éœ€è¦åˆ†æˆå‡ æ¬¡åˆ†åˆ«å¤„ç†ã€‚</p>
<blockquote>
<p>ä¾‹å¦‚åš8ä¸ª8ä½æ•´æ•°åŠ æ³•(c[i] = a[i] + b[i]. i âˆˆ {0,1,â€¦,7})ã€‚</p>
<blockquote>
<p>æ ‡é‡ç®—æ³•æµç¨‹ï¼š<br />
i = 0<br />
å°†a[i]è¯»å…¥å¯„å­˜å™¨0<br />
å°†b[i]è¯»å…¥å¯„å­˜å™¨1<br />
å¯¹å¯„å­˜å™¨0å’Œ1å†…çš„8ä½æ•´æ•°æ±‚å’Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨å¯„å­˜å™¨0ä¸­<br />
å°†å¯„å­˜å™¨0ä¸­çš„å…«ä½æ•´æ•°å†™å…¥c[i]çš„å†…å­˜ä½ç½®<br />
i = i+1<br />
æ¯”è¾ƒiå’Œ8<br />
å¦‚æœå°äºåˆ™é‡å¤ä»¥ä¸Šæ­¥éª¤</p>
</blockquote>
<blockquote>
<p>çŸ¢é‡ç®—æ³•æµç¨‹ï¼š<br />
å°†a[0-7]è¯»å…¥çŸ¢é‡å¯„å­˜å™¨0<br />
å°†b[0-7]è¯»å…¥çŸ¢é‡å¯„å­˜å™¨1<br />
å¯¹çŸ¢é‡å¯„å­˜å™¨0å’Œ1æŒ‰ç…§8ä½ä¸€ä¸ªæ•´æ•°åŒæ—¶æ±‚å’Œï¼Œç»“æœå­˜å‚¨åœ¨çŸ¢é‡å¯„å­˜å™¨0ä¸­<br />
å°†é€‚é‡å¯„å­˜å™¨0ä¸­çš„64ä½æ•°æ®å†™å…¥cçš„å†…å­˜ä½ç½®</p>
</blockquote>
</blockquote>
<p>å¦‚ä¸Šä¾‹ï¼Œå¯¹äº8ä½æ•´æ•°çš„åŠ æ³•ï¼Œç†è®ºä¸Šæœ€å¤§å¯ä»¥æœ‰8å€çš„æé€Ÿã€‚</p>
<p>ä¹‹åï¼ŒSSEå‡ºç°äº†ï¼Œæä¾›äº†8ä¸ª128ä½å¯„å­˜å™¨(XMM0 - XMM7)ï¼Œå¹¶ä¸”æœ‰äº†å¤„ç†æµ®ç‚¹æ•°çš„èƒ½åŠ›ã€‚å¯ä»¥åŒæ—¶å¤„ç†ä¸¤ä¸ªåŒç²¾åº¦æµ®ç‚¹æ•°æˆ–å››ä¸ªå•ç²¾åº¦æµ®ç‚¹æ•°ï¼Œæˆ–è€…åŒæ—¶å¤„ç†å››ä¸ª32ä½æ•´æ•°æˆ–è€…å…«ä¸ª16ä½æ•´æ•°åˆæˆ–è€…åå…­ä¸ª8ä½æ•´æ•°ã€‚</p>
<p>å†åæ¥ï¼Œåˆå‡çº§äº†AVXã€‚AVXå°†SSEçš„æ¯ä¸ª128ä½å¯„å­˜å™¨æ‰©å±•åˆ°256ä½ï¼Œå¹¶å¢åŠ äº†8ä¸ª256å¯„å­˜å™¨ã€‚16ä¸ª256ä½å¯„å­˜å™¨ç§°ä½œ(YMM0 - YMM15)ã€‚å†åæ¥Intelåˆæ¨å‡ºäº†AVX512ï¼ŒæŠŠYMMæ‰©å±•åˆ°512ä½ï¼Œåˆæ–°å¢16ä¸ªå¯„å­˜å™¨ï¼Œå…±32ä¸ª512ä½å¯„å­˜å™¨(ZMM0 - ZMM31)ã€‚(å‰å‡ å¤©Linusè¿˜æ€’æ–¥äº†Intelçš„AVX512ğŸ¤£)</p>
<p>x40æœåŠ¡å™¨æ˜¯æ”¯æŒAVX512çš„ï¼Œä½†æ˜¯æœ¬æŒ‡å—ä¸ä»‹ç»AVX512ä½¿ç”¨æ–¹æ³•(ä¸»è¦æ˜¯å› ä¸ºæˆ‘ä¹Ÿæ²¡ç”¨è¿‡)ã€‚ä½†æ˜¯åŸåˆ™ä¸Šä¸AVXå¤§åŒå°å¼‚ã€‚è€Œä¸”ï¼Œå¤§æ¦‚ç‡æ‚¨æ­£åœ¨ä½¿ç”¨çš„æ¡Œé¢ç”µè„‘æˆ–ç¬”è®°æœ¬ç”µè„‘ä¹Ÿæ”¯æŒAVXæŒ‡ä»¤é›†ï¼Œä½†ä¸å¤§å¯èƒ½æ”¯æŒAVX512ï¼Œå› æ­¤æœ¬ç« çš„ä»£ç æ‚¨å¯ä»¥åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šè¿è¡Œ/æµ‹è¯•ã€‚</p>
<div id="muladd_base" class="section level2">
<h2><span class="header-section-number">1.1</span> ä¸€ä¸ªç®€å•çš„ç¨‹åº</h2>
<blockquote>
<p><em>å˜ç´”ãªé¦¬é¹¿ã«ã‚ã‚ŠãŸã„ã€‚â€”â€”ã€æ—¥å¸¸ã€</em></p>
</blockquote>
<p>ä¸ºä¾¿äºæ¼”ç¤ºSIMDå¹¶æ¯”è¾ƒé€Ÿåº¦ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªéå¸¸éå¸¸ç®€å•çš„ç¨‹åºï¼šæ‹¿ä¸‰ä¸ªdoubleæ•°ç»„ï¼Œç¬¬ä¸€ç»„ä¹˜ä¸Šç¬¬äºŒç»„å†åŠ ä¸Šç¬¬ä¸‰ç»„ï¼Œç»“æœå­˜å‚¨åœ¨ç¬¬å››ä¸ªæ•°ç»„ä¸­ã€‚æƒ³å¿…å„ä½è¯»è€…éƒ½èƒ½å¾ˆå¿«å®ç°è¿™æ ·çš„ç®—æ³•ã€‚ä¸‹é¢åˆ—å‡ºæœ¬æŒ‡å—ä½¿ç”¨çš„ç¨‹åºï¼ˆåç»­ç« èŠ‚ä¼šåŸºäºè¿™ä¸ªç¨‹åºè¿›è¡Œæ”¹é€ ï¼‰ã€‚ä¸ºäº†åŠ å¤§å¤„ç†å‹åŠ›ï¼Œä½¿è¿è¡Œæ—¶é—´å¯ä»¥è§‚æµ‹åˆ°ï¼Œè¿™é‡Œå¼ºè¡Œè®©ç¨‹åºç®—1,000,000éã€‚å¯ä»¥åœ¨è¾“å‡ºä¸­çœ‹åˆ°è®¡ç®—è€—æ—¶åœ¨10så·¦å³ã€‚åœ¨è¾“å‡ºè¿è¡Œæ—¶é—´åï¼ŒæŒ‘å‡ºä¸€äº›ç»“æœæ¥å¯¹ç…§ä¸€ä¸‹çœ‹çœ‹å¯¹ä¸å¯¹ï¼ˆå—¯ï¼Œåœ¨è¿™ä¸ªç¨‹åºé‡Œä¸Šé¢å’Œä¸‹é¢ä¸€æ¯›ä¸€æ ·ï¼Œæ€ä¹ˆä¼šä¸å¯¹å‘¢ï¼ï¼‰</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="csimd.html#cb1-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1-2"><a href="csimd.html#cb1-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb1-3"><a href="csimd.html#cb1-3"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb1-4"><a href="csimd.html#cb1-4"></a></span>
<span id="cb1-5"><a href="csimd.html#cb1-5"></a>__attribute__ ((noinline))</span>
<span id="cb1-6"><a href="csimd.html#cb1-6"></a><span class="dt">void</span> muladd(<span class="dt">double</span>* a, <span class="dt">double</span>* b, <span class="dt">double</span>* c,</span>
<span id="cb1-7"><a href="csimd.html#cb1-7"></a>            <span class="dt">double</span>* d, <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> N){</span>
<span id="cb1-8"><a href="csimd.html#cb1-8"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> i;</span>
<span id="cb1-9"><a href="csimd.html#cb1-9"></a>    <span class="cf">for</span>(i = <span class="dv">0</span>; i &lt; N; i++){</span>
<span id="cb1-10"><a href="csimd.html#cb1-10"></a>        d[i] = a[i] * b[i] + c[i];</span>
<span id="cb1-11"><a href="csimd.html#cb1-11"></a>    }</span>
<span id="cb1-12"><a href="csimd.html#cb1-12"></a>}</span>
<span id="cb1-13"><a href="csimd.html#cb1-13"></a></span>
<span id="cb1-14"><a href="csimd.html#cb1-14"></a><span class="dt">int</span> main(){</span>
<span id="cb1-15"><a href="csimd.html#cb1-15"></a>    <span class="dt">double</span>* a; </span>
<span id="cb1-16"><a href="csimd.html#cb1-16"></a>    <span class="dt">double</span>* b; </span>
<span id="cb1-17"><a href="csimd.html#cb1-17"></a>    <span class="dt">double</span>* c; </span>
<span id="cb1-18"><a href="csimd.html#cb1-18"></a>    <span class="dt">double</span>* d;</span>
<span id="cb1-19"><a href="csimd.html#cb1-19"></a></span>
<span id="cb1-20"><a href="csimd.html#cb1-20"></a>    a = (<span class="dt">double</span>*)(malloc(<span class="dv">8192</span>*<span class="kw">sizeof</span>(<span class="dt">double</span>)));</span>
<span id="cb1-21"><a href="csimd.html#cb1-21"></a>    b = (<span class="dt">double</span>*)(malloc(<span class="dv">8192</span>*<span class="kw">sizeof</span>(<span class="dt">double</span>)));</span>
<span id="cb1-22"><a href="csimd.html#cb1-22"></a>    c = (<span class="dt">double</span>*)(malloc(<span class="dv">8192</span>*<span class="kw">sizeof</span>(<span class="dt">double</span>)));</span>
<span id="cb1-23"><a href="csimd.html#cb1-23"></a>    d = (<span class="dt">double</span>*)(malloc(<span class="dv">8192</span>*<span class="kw">sizeof</span>(<span class="dt">double</span>)));</span>
<span id="cb1-24"><a href="csimd.html#cb1-24"></a></span>
<span id="cb1-25"><a href="csimd.html#cb1-25"></a>    <span class="co">//Prepare data</span></span>
<span id="cb1-26"><a href="csimd.html#cb1-26"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> i;</span>
<span id="cb1-27"><a href="csimd.html#cb1-27"></a>    <span class="cf">for</span>(i = <span class="dv">0</span>; i &lt; <span class="dv">8192</span>; i++){</span>
<span id="cb1-28"><a href="csimd.html#cb1-28"></a>        a[i] = (<span class="dt">double</span>)(rand()%<span class="dv">2000</span>) / <span class="fl">200.0</span>;</span>
<span id="cb1-29"><a href="csimd.html#cb1-29"></a>        b[i] = (<span class="dt">double</span>)(rand()%<span class="dv">2000</span>) / <span class="fl">200.0</span>;</span>
<span id="cb1-30"><a href="csimd.html#cb1-30"></a>        c[i] = ((<span class="dt">double</span>)i)/<span class="fl">10000.0</span>;</span>
<span id="cb1-31"><a href="csimd.html#cb1-31"></a>    }</span>
<span id="cb1-32"><a href="csimd.html#cb1-32"></a>    </span>
<span id="cb1-33"><a href="csimd.html#cb1-33"></a>    clock_t start, stop;</span>
<span id="cb1-34"><a href="csimd.html#cb1-34"></a>    <span class="dt">double</span> elapsed;</span>
<span id="cb1-35"><a href="csimd.html#cb1-35"></a>    start = clock();</span>
<span id="cb1-36"><a href="csimd.html#cb1-36"></a></span>
<span id="cb1-37"><a href="csimd.html#cb1-37"></a>    <span class="cf">for</span>(i = <span class="dv">0</span>; i &lt; <span class="dv">1000000</span>; i++){</span>
<span id="cb1-38"><a href="csimd.html#cb1-38"></a>        muladd(a, b, c, d, <span class="dv">8192</span>);</span>
<span id="cb1-39"><a href="csimd.html#cb1-39"></a>    }</span>
<span id="cb1-40"><a href="csimd.html#cb1-40"></a></span>
<span id="cb1-41"><a href="csimd.html#cb1-41"></a>    stop = clock();</span>
<span id="cb1-42"><a href="csimd.html#cb1-42"></a>    elapsed = (<span class="dt">double</span>)(stop-start) / CLOCKS_PER_SEC;</span>
<span id="cb1-43"><a href="csimd.html#cb1-43"></a>    printf(<span class="st">&quot;Elapsed time = %8.6f s</span><span class="sc">\n</span><span class="st">&quot;</span>, elapsed);</span>
<span id="cb1-44"><a href="csimd.html#cb1-44"></a>    <span class="cf">for</span>(i = <span class="dv">0</span>; i &lt; <span class="dv">8192</span>; i++){</span>
<span id="cb1-45"><a href="csimd.html#cb1-45"></a>        <span class="cf">if</span>(i % <span class="dv">1001</span> == <span class="dv">0</span>){</span>
<span id="cb1-46"><a href="csimd.html#cb1-46"></a>            printf(<span class="st">&quot;%5llu: %12.8f * %12.8f + %12.8f = %12.8f (%d)</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb1-47"><a href="csimd.html#cb1-47"></a>                   i, a[i], b[i], c[i], d[i], d[i]==a[i]*b[i]+c[i]);</span>
<span id="cb1-48"><a href="csimd.html#cb1-48"></a>        }</span>
<span id="cb1-49"><a href="csimd.html#cb1-49"></a>    }</span>
<span id="cb1-50"><a href="csimd.html#cb1-50"></a></span>
<span id="cb1-51"><a href="csimd.html#cb1-51"></a>    free(a);</span>
<span id="cb1-52"><a href="csimd.html#cb1-52"></a>    free(b);</span>
<span id="cb1-53"><a href="csimd.html#cb1-53"></a>    free(c);</span>
<span id="cb1-54"><a href="csimd.html#cb1-54"></a>    free(d);</span>
<span id="cb1-55"><a href="csimd.html#cb1-55"></a>}</span></code></pre></div>
<blockquote>
<p>å…³äºç¨‹åºéšä¾¿æä¸€å¥ã€‚<code>__attribute__ ((noinline))</code>çš„ä½œç”¨æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ä¸è¦å¯¹è¿™ä¸ªå‡½æ•°inlineå±•å¼€ã€‚å› ä¸ºæˆ‘ä»¬çš„muladdå‡½æ•°æ¯”è¾ƒç®€å•ï¼Œå¯èƒ½ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–ä»¥åç›´æ¥åœ¨è°ƒç”¨å¤„åŸåœ°å±•å¼€ã€‚è™½ç„¶è¿™æ ·ä¹Ÿæ²¡ä»€ä¹ˆä¸è¡Œï¼Œä½†æ˜¯ä¸ºäº†åç»­åˆ†æç¨‹åºè¡Œä¸ºï¼Œè¿™é‡ŒåŠ ä¸Šäº†è¿™ä¸ªæ ‡å¿—ã€‚</p>
</blockquote>
<p>ç¼–è¯‘è¿è¡Œä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°è¿ç®—è¿‡ç¨‹èŠ±äº†20så·¦å³ã€‚</p>
</div>
<div id="csimd_first" class="section level2">
<h2><span class="header-section-number">1.2</span> æˆ‘çš„ç¬¬ä¸€ä¸ªSIMDç¨‹åºï¼</h2>
<blockquote>
<p><em>May the 4s be with you.</em></p>
</blockquote>
<p>æˆ‘ä»¬æ¥ä½¿ç”¨AVXï¼Œä¸€æ¬¡ç®—å››ä¸ªã€‚è¦æ˜¾å¼åœ°ä½¿ç”¨AVXæŒ‡ä»¤é›†ï¼Œå¯ä»¥ä½¿ç”¨æ‰€è°“â€œintrinsicâ€ã€‚è¿™äº›intrinsicä¸CPUæŒ‡ä»¤æœ‰ç›´æ¥çš„å¯¹åº”ã€‚å¯ä»¥å‚è€ƒ<a href="https://software.intel.com/sites/landingpage/IntrinsicsGuide/">Intel Intrinsics Guide</a>ã€‚è¦ä½¿ç”¨è¿™äº›intrinsicï¼Œéœ€è¦<code>#include &lt;x86intrin.h&gt;</code>.
åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œè¿˜è¦åŠ ä¸Š<code>-mavx</code></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="csimd.html#cb2-1"></a><span class="fu">gcc</span> -mavx -o muladd_simd muladd_simd.c</span></code></pre></div>
<p>æ”¹é€ åçš„ç¨‹åºæ˜¯è¿™ä¸ªæ ·å­ï¼š</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="csimd.html#cb3-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb3-2"><a href="csimd.html#cb3-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb3-3"><a href="csimd.html#cb3-3"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb3-4"><a href="csimd.html#cb3-4"></a><span class="pp">#include </span><span class="im">&lt;x86intrin.h&gt;</span></span>
<span id="cb3-5"><a href="csimd.html#cb3-5"></a></span>
<span id="cb3-6"><a href="csimd.html#cb3-6"></a>__attribute__ ((noinline))</span>
<span id="cb3-7"><a href="csimd.html#cb3-7"></a><span class="dt">void</span> muladd(<span class="dt">double</span>* a, <span class="dt">double</span>* b, <span class="dt">double</span>* c,</span>
<span id="cb3-8"><a href="csimd.html#cb3-8"></a>            <span class="dt">double</span>* d, <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> N){</span>
<span id="cb3-9"><a href="csimd.html#cb3-9"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> i, j;</span>
<span id="cb3-10"><a href="csimd.html#cb3-10"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> M = N&gt;&gt;<span class="dv">2</span>;</span>
<span id="cb3-11"><a href="csimd.html#cb3-11"></a>    <span class="cf">for</span>(i = <span class="dv">0</span>; i &lt; M; i++){</span>
<span id="cb3-12"><a href="csimd.html#cb3-12"></a>        __m256d ymma = _mm256_load_pd(a+i*<span class="dv">4</span>);</span>
<span id="cb3-13"><a href="csimd.html#cb3-13"></a>        __m256d ymmb = _mm256_load_pd(b+i*<span class="dv">4</span>);</span>
<span id="cb3-14"><a href="csimd.html#cb3-14"></a>        __m256d ymmc = _mm256_load_pd(c+i*<span class="dv">4</span>);</span>
<span id="cb3-15"><a href="csimd.html#cb3-15"></a>        __m256d ymmd = _mm256_mul_pd(ymma, ymmb);</span>
<span id="cb3-16"><a href="csimd.html#cb3-16"></a>        ymmd = _mm256_add_pd(ymmd, ymmc);</span>
<span id="cb3-17"><a href="csimd.html#cb3-17"></a>        _mm256_store_pd(d+i*<span class="dv">4</span>,ymmd);</span>
<span id="cb3-18"><a href="csimd.html#cb3-18"></a>    }</span>
<span id="cb3-19"><a href="csimd.html#cb3-19"></a>    <span class="cf">for</span>(i = N-N%<span class="dv">4</span>; i &lt; N; i++){</span>
<span id="cb3-20"><a href="csimd.html#cb3-20"></a>        d[i] = a[i] * b[i] + c[i];</span>
<span id="cb3-21"><a href="csimd.html#cb3-21"></a>    }</span>
<span id="cb3-22"><a href="csimd.html#cb3-22"></a>}</span>
<span id="cb3-23"><a href="csimd.html#cb3-23"></a></span>
<span id="cb3-24"><a href="csimd.html#cb3-24"></a><span class="dt">int</span> main(){</span>
<span id="cb3-25"><a href="csimd.html#cb3-25"></a>    <span class="dt">double</span>* a; </span>
<span id="cb3-26"><a href="csimd.html#cb3-26"></a>    <span class="dt">double</span>* b; </span>
<span id="cb3-27"><a href="csimd.html#cb3-27"></a>    <span class="dt">double</span>* c; </span>
<span id="cb3-28"><a href="csimd.html#cb3-28"></a>    <span class="dt">double</span>* d;</span>
<span id="cb3-29"><a href="csimd.html#cb3-29"></a></span>
<span id="cb3-30"><a href="csimd.html#cb3-30"></a>    a = (<span class="dt">double</span>*)(aligned_alloc(<span class="dv">32</span>,<span class="dv">8192</span>*<span class="kw">sizeof</span>(<span class="dt">double</span>)));</span>
<span id="cb3-31"><a href="csimd.html#cb3-31"></a>    b = (<span class="dt">double</span>*)(aligned_alloc(<span class="dv">32</span>,<span class="dv">8192</span>*<span class="kw">sizeof</span>(<span class="dt">double</span>)));</span>
<span id="cb3-32"><a href="csimd.html#cb3-32"></a>    c = (<span class="dt">double</span>*)(aligned_alloc(<span class="dv">32</span>,<span class="dv">8192</span>*<span class="kw">sizeof</span>(<span class="dt">double</span>)));</span>
<span id="cb3-33"><a href="csimd.html#cb3-33"></a>    d = (<span class="dt">double</span>*)(aligned_alloc(<span class="dv">32</span>,<span class="dv">8192</span>*<span class="kw">sizeof</span>(<span class="dt">double</span>)));</span>
<span id="cb3-34"><a href="csimd.html#cb3-34"></a></span>
<span id="cb3-35"><a href="csimd.html#cb3-35"></a>   <span class="co">//Prepare data</span></span>
<span id="cb3-36"><a href="csimd.html#cb3-36"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> i;</span>
<span id="cb3-37"><a href="csimd.html#cb3-37"></a>    <span class="cf">for</span>(i = <span class="dv">0</span>; i &lt; <span class="dv">8192</span>; i++){</span>
<span id="cb3-38"><a href="csimd.html#cb3-38"></a>        a[i] = (<span class="dt">double</span>)(rand()%<span class="dv">2000</span>) / <span class="fl">200.0</span>;</span>
<span id="cb3-39"><a href="csimd.html#cb3-39"></a>        b[i] = (<span class="dt">double</span>)(rand()%<span class="dv">2000</span>) / <span class="fl">200.0</span>;</span>
<span id="cb3-40"><a href="csimd.html#cb3-40"></a>        c[i] = ((<span class="dt">double</span>)i)/<span class="fl">10000.0</span>;</span>
<span id="cb3-41"><a href="csimd.html#cb3-41"></a>    }</span>
<span id="cb3-42"><a href="csimd.html#cb3-42"></a>    </span>
<span id="cb3-43"><a href="csimd.html#cb3-43"></a>    clock_t start, stop;</span>
<span id="cb3-44"><a href="csimd.html#cb3-44"></a>    <span class="dt">double</span> elapsed;</span>
<span id="cb3-45"><a href="csimd.html#cb3-45"></a>    start = clock();</span>
<span id="cb3-46"><a href="csimd.html#cb3-46"></a>    </span>
<span id="cb3-47"><a href="csimd.html#cb3-47"></a>    <span class="cf">for</span>(i = <span class="dv">0</span>; i &lt; <span class="dv">1000000</span>; i++){</span>
<span id="cb3-48"><a href="csimd.html#cb3-48"></a>        muladd(a, b, c, d, <span class="dv">8192</span>);</span>
<span id="cb3-49"><a href="csimd.html#cb3-49"></a>    }</span>
<span id="cb3-50"><a href="csimd.html#cb3-50"></a></span>
<span id="cb3-51"><a href="csimd.html#cb3-51"></a>    stop = clock();</span>
<span id="cb3-52"><a href="csimd.html#cb3-52"></a>    elapsed = (<span class="dt">double</span>)(stop-start) / CLOCKS_PER_SEC;</span>
<span id="cb3-53"><a href="csimd.html#cb3-53"></a>    printf(<span class="st">&quot;Elapsed time = %8.6f s</span><span class="sc">\n</span><span class="st">&quot;</span>, elapsed);</span>
<span id="cb3-54"><a href="csimd.html#cb3-54"></a>    <span class="cf">for</span>(i = <span class="dv">0</span>; i &lt; <span class="dv">8192</span>; i++){</span>
<span id="cb3-55"><a href="csimd.html#cb3-55"></a>        <span class="cf">if</span>(i % <span class="dv">1001</span> == <span class="dv">0</span>){</span>
<span id="cb3-56"><a href="csimd.html#cb3-56"></a>            printf(<span class="st">&quot;%5llu: %16.8f * %16.8f + %16.8f = %16.8f (%d)</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb3-57"><a href="csimd.html#cb3-57"></a>                   i, a[i], b[i], c[i], d[i], d[i]==a[i]*b[i]+c[i]);</span>
<span id="cb3-58"><a href="csimd.html#cb3-58"></a>        }</span>
<span id="cb3-59"><a href="csimd.html#cb3-59"></a>    }</span>
<span id="cb3-60"><a href="csimd.html#cb3-60"></a></span>
<span id="cb3-61"><a href="csimd.html#cb3-61"></a>    free(a);</span>
<span id="cb3-62"><a href="csimd.html#cb3-62"></a>    free(b);</span>
<span id="cb3-63"><a href="csimd.html#cb3-63"></a>    free(c);</span>
<span id="cb3-64"><a href="csimd.html#cb3-64"></a>    free(d);</span>
<span id="cb3-65"><a href="csimd.html#cb3-65"></a>}</span></code></pre></div>
<blockquote>
<p>å…³äºè¿™æ®µç¨‹åºåˆè¦æä¸€å¥ã€‚<code>malloc(8192*sizeof(double))</code>æ¢æˆäº†<code>aligned_alloc(32, 8192*sizeof(double))</code>. è¿™æ˜¯å› ä¸º<code>_mm256_load_pd</code>è¦æ±‚å†…å­˜æ˜¯å¯¹é½åˆ°256bitçš„(YMMå¯„å­˜å™¨çš„å®½åº¦æ˜¯256bit).<code>aligned_alloc</code>å‡½æ•°å¯ä»¥å®ç°å¼€è¾Ÿå¯¹é½åˆ°æŒ‡å®šåœ°å€çš„å†…å­˜ç©ºé—´ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯¹é½æ–¹å¼ï¼Œå•ä½æ˜¯å­—èŠ‚(Byte)(32Byte Ã— 8bit/byte = 256 bit)ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯å†…å­˜å¤§å°ã€‚è¦æ³¨æ„ç¬¬äºŒä¸ªå‚æ•°å¿…é¡»æ˜¯ç¬¬ä¸€ä¸ªçš„æ•´æ•°å€ã€‚<br />
å¦å¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥<code>malloc</code>ï¼Œè€ŒæŠŠ<code>_mm256_load_pd</code>æ›¿æ¢ä¸º<code>_mm256_load_upd</code>. uä»£è¡¨â€œunalignedâ€ã€‚</p>
<blockquote>
<p><em>ä»¥ä¸‹å¤ªé•¿ä¸çœ‹</em><br />
è¯»å–åŒç²¾åº¦æµ®ç‚¹æ•°æ®åˆ°YMMæœ‰ä¸¤ä¸ªæŒ‡ä»¤ï¼ŒVMOVAPD å’Œ VMOVUPDã€‚VMOVAPDè¦æ±‚å†…å­˜åœ°å€æ˜¯å¯¹é½åˆ°256ä½çš„ï¼Œè€ŒVMOVUPDæ— æ­¤è¦æ±‚ã€‚æ®è¯´åœ¨æ—©æœŸçš„æ”¯æŒAVXçš„cpuä¸ŠVMOVAPDè¦å¿«ä¸€äº›ï¼Œä¼¼ä¹åœ¨æ–°ä¸€äº›çš„å¹³å°ä¸Šæ€§èƒ½å·²ç»ç›¸å½“äº†ã€‚ï¼ˆä½†æˆ‘æ²¡æœ‰è¯¦ç»†è€ƒè¯è¿‡ã€‚ï¼‰ä»¥åŠï¼Œ<code>_mm256_load_upd</code>ä¼¼ä¹å¹¶ä¸ä¼šè¢«ç¿»è¯‘ä¸ºvmovupdï¼Œè€Œæ˜¯å˜æˆäº†ä¸¤æ¡æŒ‡ä»¤ï¼Œå¤§è‡´æ˜¯å…ˆè¯»å…¥ä¸¤ä¸ªdoubleï¼Œå†æŠŠå¦å¤–ä¸¤ä¸ªæ’å…¥è¿›æ¥ã€‚emmâ€¦</p>
</blockquote>
</blockquote>
<p>èµ¶ç´§ç¼–è¯‘è¿è¡Œä¸€ä¸‹ï¼Œè¿™å›å¯å¿«äº†ï¼Œåªè¦â€¦â€¦å—¯ï¼Ÿè¦16sï¼Ÿ4ä¸ªdoubleåŒæ—¶ç®—ï¼Œè¿™æå‡ä¹Ÿå¤ªå°äº†å§ï¼Ÿå’±ä»¬çœ‹ä¸€ä¸‹ç¼–è¯‘å‡ºæ¥çš„å†…å®¹ï¼š</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="csimd.html#cb4-1"></a>$ <span class="fu">gdb</span> muladd_simd</span>
<span id="cb4-2"><a href="csimd.html#cb4-2"></a>  <span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">disassemble</span> muladd</span>
<span id="cb4-3"><a href="csimd.html#cb4-3"></a>  <span class="ex">Dump</span> of assembler code for function muladd:</span>
<span id="cb4-4"><a href="csimd.html#cb4-4"></a>   <span class="ex">0x0000000000400657</span> <span class="op">&lt;</span>+<span class="op">0&gt;</span>:     lea    0x8(%rsp),<span class="ex">%r10</span></span>
<span id="cb4-5"><a href="csimd.html#cb4-5"></a>   <span class="ex">0x000000000040065c</span> <span class="op">&lt;</span>+<span class="op">5&gt;</span>:     and    <span class="va">$0</span>xffffffffffffffe0,%rsp</span>
<span id="cb4-6"><a href="csimd.html#cb4-6"></a>   <span class="ex">0x0000000000400660</span> <span class="op">&lt;</span>+<span class="op">9&gt;</span>:     pushq  -0x8(%r10)</span>
<span id="cb4-7"><a href="csimd.html#cb4-7"></a>   <span class="ex">0x0000000000400664</span> <span class="op">&lt;</span>+<span class="op">13&gt;</span>:    push   %rbp</span>
<span id="cb4-8"><a href="csimd.html#cb4-8"></a>   <span class="ex">0x0000000000400665</span> <span class="op">&lt;</span>+<span class="op">14&gt;</span>:    mov    %rsp,%rbp</span>
<span id="cb4-9"><a href="csimd.html#cb4-9"></a>   <span class="ex">0x0000000000400668</span> <span class="op">&lt;</span>+<span class="op">17&gt;</span>:    push   %r10</span>
<span id="cb4-10"><a href="csimd.html#cb4-10"></a>   <span class="ex">0x000000000040066a</span> <span class="op">&lt;</span>+<span class="op">19&gt;</span>:    sub    <span class="va">$0</span>x150,%rsp</span>
<span id="cb4-11"><a href="csimd.html#cb4-11"></a>   <span class="ex">0x0000000000400671</span> <span class="op">&lt;</span>+<span class="op">26&gt;</span>:    mov    %rdi,-0x198(%rbp)</span>
<span id="cb4-12"><a href="csimd.html#cb4-12"></a>   <span class="ex">0x0000000000400678</span> <span class="op">&lt;</span>+<span class="op">33&gt;</span>:    mov    %rsi,-0x1a0(%rbp)</span>
<span id="cb4-13"><a href="csimd.html#cb4-13"></a>   <span class="ex">0x000000000040067f</span> <span class="op">&lt;</span>+<span class="op">40&gt;</span>:    mov    %rdx,-0x1a8(%rbp)</span>
<span id="cb4-14"><a href="csimd.html#cb4-14"></a>   <span class="ex">0x0000000000400686</span> <span class="op">&lt;</span>+<span class="op">47&gt;</span>:    mov    %rcx,-0x1b0(%rbp)</span>
<span id="cb4-15"><a href="csimd.html#cb4-15"></a>   <span class="ex">0x000000000040068d</span> <span class="op">&lt;</span>+<span class="op">54&gt;</span>:    mov    %r8,-0x1b8(%rbp)</span>
<span id="cb4-16"><a href="csimd.html#cb4-16"></a>   <span class="ex">0x0000000000400694</span> <span class="op">&lt;</span>+<span class="op">61&gt;</span>:    mov    -0x1b8(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-17"><a href="csimd.html#cb4-17"></a>   <span class="ex">0x000000000040069b</span> <span class="op">&lt;</span>+<span class="op">68&gt;</span>:    shr    <span class="va">$0</span>x2,%rax</span>
<span id="cb4-18"><a href="csimd.html#cb4-18"></a>   <span class="ex">0x000000000040069f</span> <span class="op">&lt;</span>+<span class="op">72&gt;</span>:    mov    %rax,-0x20(%rbp)</span>
<span id="cb4-19"><a href="csimd.html#cb4-19"></a>   <span class="ex">0x00000000004006a3</span> <span class="op">&lt;</span>+<span class="op">76&gt;</span>:    movq   <span class="va">$0</span>x0,-0x18(%rbp)</span>
<span id="cb4-20"><a href="csimd.html#cb4-20"></a>   <span class="ex">0x00000000004006ab</span> <span class="op">&lt;</span>+<span class="op">84&gt;</span>:    jmpq   0x4007e5 <span class="op">&lt;</span>muladd+<span class="op">398&gt;</span></span>
<span id="cb4-21"><a href="csimd.html#cb4-21"></a>   <span class="ex">0x00000000004006b0</span> <span class="op">&lt;</span>+<span class="op">89&gt;</span>:    mov    -0x18(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-22"><a href="csimd.html#cb4-22"></a>   <span class="ex">0x00000000004006b4</span> <span class="op">&lt;</span>+<span class="op">93&gt;</span>:    shl    <span class="va">$0</span>x5,%rax</span>
<span id="cb4-23"><a href="csimd.html#cb4-23"></a>   <span class="ex">0x00000000004006b8</span> <span class="op">&lt;</span>+<span class="op">97&gt;</span>:    mov    %rax,%rdx</span>
<span id="cb4-24"><a href="csimd.html#cb4-24"></a>   <span class="ex">0x00000000004006bb</span> <span class="op">&lt;</span>+<span class="op">100&gt;</span>:   mov    -0x198(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-25"><a href="csimd.html#cb4-25"></a>   <span class="ex">0x00000000004006c2</span> <span class="op">&lt;</span>+<span class="op">107&gt;</span>:   add    %rdx,%rax</span>
<span id="cb4-26"><a href="csimd.html#cb4-26"></a>   <span class="ex">0x00000000004006c5</span> <span class="op">&lt;</span>+<span class="op">110&gt;</span>:   mov    %rax,-0x188(%rbp)</span>
<span id="cb4-27"><a href="csimd.html#cb4-27"></a>   <span class="ex">0x00000000004006cc</span> <span class="op">&lt;</span>+<span class="op">117&gt;</span>:   mov    -0x188(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-28"><a href="csimd.html#cb4-28"></a>   <span class="ex">0x00000000004006d3</span> <span class="op">&lt;</span>+<span class="op">124&gt;</span>:   vmovapd (%rax),<span class="ex">%ymm0</span></span>
<span id="cb4-29"><a href="csimd.html#cb4-29"></a>   <span class="ex">0x00000000004006d7</span> <span class="op">&lt;</span>+<span class="op">128&gt;</span>:   vmovapd %ymm0,-0x50(%rbp)</span>
<span id="cb4-30"><a href="csimd.html#cb4-30"></a>   <span class="ex">0x00000000004006dc</span> <span class="op">&lt;</span>+<span class="op">133&gt;</span>:   mov    -0x18(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-31"><a href="csimd.html#cb4-31"></a>   <span class="ex">0x00000000004006e0</span> <span class="op">&lt;</span>+<span class="op">137&gt;</span>:   shl    <span class="va">$0</span>x5,%rax</span>
<span id="cb4-32"><a href="csimd.html#cb4-32"></a>   <span class="ex">0x00000000004006e4</span> <span class="op">&lt;</span>+<span class="op">141&gt;</span>:   mov    %rax,%rdx</span>
<span id="cb4-33"><a href="csimd.html#cb4-33"></a>   <span class="ex">0x00000000004006e7</span> <span class="op">&lt;</span>+<span class="op">144&gt;</span>:   mov    -0x1a0(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-34"><a href="csimd.html#cb4-34"></a>   <span class="ex">0x00000000004006ee</span> <span class="op">&lt;</span>+<span class="op">151&gt;</span>:   add    %rdx,%rax</span>
<span id="cb4-35"><a href="csimd.html#cb4-35"></a>   <span class="ex">0x00000000004006f1</span> <span class="op">&lt;</span>+<span class="op">154&gt;</span>:   mov    %rax,-0x180(%rbp)</span>
<span id="cb4-36"><a href="csimd.html#cb4-36"></a>   <span class="ex">0x00000000004006f8</span> <span class="op">&lt;</span>+<span class="op">161&gt;</span>:   mov    -0x180(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-37"><a href="csimd.html#cb4-37"></a>   <span class="ex">0x00000000004006ff</span> <span class="op">&lt;</span>+<span class="op">168&gt;</span>:   vmovapd (%rax),<span class="ex">%ymm0</span></span>
<span id="cb4-38"><a href="csimd.html#cb4-38"></a>   <span class="ex">0x0000000000400703</span> <span class="op">&lt;</span>+<span class="op">172&gt;</span>:   vmovapd %ymm0,-0x70(%rbp)</span>
<span id="cb4-39"><a href="csimd.html#cb4-39"></a>   <span class="ex">0x0000000000400708</span> <span class="op">&lt;</span>+<span class="op">177&gt;</span>:   mov    -0x18(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-40"><a href="csimd.html#cb4-40"></a>   <span class="ex">0x000000000040070c</span> <span class="op">&lt;</span>+<span class="op">181&gt;</span>:   shl    <span class="va">$0</span>x5,%rax</span>
<span id="cb4-41"><a href="csimd.html#cb4-41"></a>   <span class="ex">0x0000000000400710</span> <span class="op">&lt;</span>+<span class="op">185&gt;</span>:   mov    %rax,%rdx</span>
<span id="cb4-42"><a href="csimd.html#cb4-42"></a>   <span class="ex">0x0000000000400713</span> <span class="op">&lt;</span>+<span class="op">188&gt;</span>:   mov    -0x1a8(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-43"><a href="csimd.html#cb4-43"></a>   <span class="ex">0x000000000040071a</span> <span class="op">&lt;</span>+<span class="op">195&gt;</span>:   add    %rdx,%rax</span>
<span id="cb4-44"><a href="csimd.html#cb4-44"></a>   <span class="ex">0x000000000040071d</span> <span class="op">&lt;</span>+<span class="op">198&gt;</span>:   mov    %rax,-0x178(%rbp)</span>
<span id="cb4-45"><a href="csimd.html#cb4-45"></a>   <span class="ex">0x0000000000400724</span> <span class="op">&lt;</span>+<span class="op">205&gt;</span>:   mov    -0x178(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-46"><a href="csimd.html#cb4-46"></a>   <span class="ex">0x000000000040072b</span> <span class="op">&lt;</span>+<span class="op">212&gt;</span>:   vmovapd (%rax),<span class="ex">%ymm0</span></span>
<span id="cb4-47"><a href="csimd.html#cb4-47"></a>   <span class="ex">0x000000000040072f</span> <span class="op">&lt;</span>+<span class="op">216&gt;</span>:   vmovapd %ymm0,-0x90(%rbp)</span>
<span id="cb4-48"><a href="csimd.html#cb4-48"></a>   <span class="ex">0x0000000000400737</span> <span class="op">&lt;</span>+<span class="op">224&gt;</span>:   vmovapd -0x50(%rbp),<span class="ex">%ymm0</span></span>
<span id="cb4-49"><a href="csimd.html#cb4-49"></a>   <span class="ex">0x000000000040073c</span> <span class="op">&lt;</span>+<span class="op">229&gt;</span>:   vmovapd %ymm0,-0x150(%rbp)</span>
<span id="cb4-50"><a href="csimd.html#cb4-50"></a>   <span class="ex">0x0000000000400744</span> <span class="op">&lt;</span>+<span class="op">237&gt;</span>:   vmovapd -0x70(%rbp),<span class="ex">%ymm0</span></span>
<span id="cb4-51"><a href="csimd.html#cb4-51"></a>   <span class="ex">0x0000000000400749</span> <span class="op">&lt;</span>+<span class="op">242&gt;</span>:   vmovapd %ymm0,-0x170(%rbp)</span>
<span id="cb4-52"><a href="csimd.html#cb4-52"></a>   <span class="ex">0x0000000000400751</span> <span class="op">&lt;</span>+<span class="op">250&gt;</span>:   vmovapd -0x150(%rbp),<span class="ex">%ymm0</span></span>
<span id="cb4-53"><a href="csimd.html#cb4-53"></a>   <span class="ex">0x0000000000400759</span> <span class="op">&lt;</span>+<span class="op">258&gt;</span>:   vmulpd -0x170(%rbp),<span class="ex">%ymm0</span>,%ymm0</span>
<span id="cb4-54"><a href="csimd.html#cb4-54"></a>   <span class="ex">0x0000000000400761</span> <span class="op">&lt;</span>+<span class="op">266&gt;</span>:   vmovapd %ymm0,-0xb0(%rbp)</span>
<span id="cb4-55"><a href="csimd.html#cb4-55"></a>   <span class="ex">0x0000000000400769</span> <span class="op">&lt;</span>+<span class="op">274&gt;</span>:   vmovapd -0xb0(%rbp),<span class="ex">%ymm0</span></span>
<span id="cb4-56"><a href="csimd.html#cb4-56"></a>   <span class="ex">0x0000000000400771</span> <span class="op">&lt;</span>+<span class="op">282&gt;</span>:   vmovapd %ymm0,-0x110(%rbp)</span>
<span id="cb4-57"><a href="csimd.html#cb4-57"></a>   <span class="ex">0x0000000000400779</span> <span class="op">&lt;</span>+<span class="op">290&gt;</span>:   vmovapd -0x90(%rbp),<span class="ex">%ymm0</span></span>
<span id="cb4-58"><a href="csimd.html#cb4-58"></a>   <span class="ex">0x0000000000400781</span> <span class="op">&lt;</span>+<span class="op">298&gt;</span>:   vmovapd %ymm0,-0x130(%rbp)</span>
<span id="cb4-59"><a href="csimd.html#cb4-59"></a>   <span class="ex">0x0000000000400789</span> <span class="op">&lt;</span>+<span class="op">306&gt;</span>:   vmovapd -0x110(%rbp),<span class="ex">%ymm0</span></span>
<span id="cb4-60"><a href="csimd.html#cb4-60"></a>   <span class="ex">0x0000000000400791</span> <span class="op">&lt;</span>+<span class="op">314&gt;</span>:   vaddpd -0x130(%rbp),<span class="ex">%ymm0</span>,%ymm0</span>
<span id="cb4-61"><a href="csimd.html#cb4-61"></a>   <span class="ex">0x0000000000400799</span> <span class="op">&lt;</span>+<span class="op">322&gt;</span>:   vmovapd %ymm0,-0xb0(%rbp)</span>
<span id="cb4-62"><a href="csimd.html#cb4-62"></a>   <span class="ex">0x00000000004007a1</span> <span class="op">&lt;</span>+<span class="op">330&gt;</span>:   mov    -0x18(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-63"><a href="csimd.html#cb4-63"></a>   <span class="ex">0x00000000004007a5</span> <span class="op">&lt;</span>+<span class="op">334&gt;</span>:   shl    <span class="va">$0</span>x5,%rax</span>
<span id="cb4-64"><a href="csimd.html#cb4-64"></a>   <span class="ex">0x00000000004007a9</span> <span class="op">&lt;</span>+<span class="op">338&gt;</span>:   mov    %rax,%rdx</span>
<span id="cb4-65"><a href="csimd.html#cb4-65"></a>   <span class="ex">0x00000000004007ac</span> <span class="op">&lt;</span>+<span class="op">341&gt;</span>:   mov    -0x1b0(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-66"><a href="csimd.html#cb4-66"></a>   <span class="ex">0x00000000004007b3</span> <span class="op">&lt;</span>+<span class="op">348&gt;</span>:   add    %rdx,%rax</span>
<span id="cb4-67"><a href="csimd.html#cb4-67"></a>   <span class="ex">0x00000000004007b6</span> <span class="op">&lt;</span>+<span class="op">351&gt;</span>:   mov    %rax,-0xb8(%rbp)</span>
<span id="cb4-68"><a href="csimd.html#cb4-68"></a>   <span class="ex">0x00000000004007bd</span> <span class="op">&lt;</span>+<span class="op">358&gt;</span>:   vmovapd -0xb0(%rbp),<span class="ex">%ymm0</span></span>
<span id="cb4-69"><a href="csimd.html#cb4-69"></a>   <span class="ex">0x00000000004007c5</span> <span class="op">&lt;</span>+<span class="op">366&gt;</span>:   vmovapd %ymm0,-0xf0(%rbp)</span>
<span id="cb4-70"><a href="csimd.html#cb4-70"></a>   <span class="ex">0x00000000004007cd</span> <span class="op">&lt;</span>+<span class="op">374&gt;</span>:   mov    -0xb8(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-71"><a href="csimd.html#cb4-71"></a>   <span class="ex">0x00000000004007d4</span> <span class="op">&lt;</span>+<span class="op">381&gt;</span>:   vmovapd -0xf0(%rbp),<span class="ex">%ymm0</span></span>
<span id="cb4-72"><a href="csimd.html#cb4-72"></a>   <span class="ex">0x00000000004007dc</span> <span class="op">&lt;</span>+<span class="op">389&gt;</span>:   vmovapd %ymm0,(%rax)</span>
<span id="cb4-73"><a href="csimd.html#cb4-73"></a>   <span class="ex">0x00000000004007e0</span> <span class="op">&lt;</span>+<span class="op">393&gt;</span>:   addq   <span class="va">$0</span>x1,-0x18(%rbp)</span>
<span id="cb4-74"><a href="csimd.html#cb4-74"></a>   <span class="ex">0x00000000004007e5</span> <span class="op">&lt;</span>+<span class="op">398&gt;</span>:   mov    -0x18(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-75"><a href="csimd.html#cb4-75"></a>   <span class="ex">0x00000000004007e9</span> <span class="op">&lt;</span>+<span class="op">402&gt;</span>:   cmp    -0x20(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-76"><a href="csimd.html#cb4-76"></a>   <span class="ex">0x00000000004007ed</span> <span class="op">&lt;</span>+<span class="op">406&gt;</span>:   jb     0x4006b0 <span class="op">&lt;</span>muladd+<span class="op">89&gt;</span></span>
<span id="cb4-77"><a href="csimd.html#cb4-77"></a>   <span class="ex">0x00000000004007f3</span> <span class="op">&lt;</span>+<span class="op">412&gt;</span>:   mov    -0x1b8(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-78"><a href="csimd.html#cb4-78"></a>   <span class="ex">0x00000000004007fa</span> <span class="op">&lt;</span>+<span class="op">419&gt;</span>:   and    <span class="va">$0</span>xfffffffffffffffc,%rax</span>
<span id="cb4-79"><a href="csimd.html#cb4-79"></a>   <span class="ex">0x00000000004007fe</span> <span class="op">&lt;</span>+<span class="op">423&gt;</span>:   mov    %rax,-0x18(%rbp)</span>
<span id="cb4-80"><a href="csimd.html#cb4-80"></a>   <span class="ex">0x0000000000400802</span> <span class="op">&lt;</span>+<span class="op">427&gt;</span>:   jmp    0x400879 <span class="op">&lt;</span>muladd+<span class="op">546&gt;</span></span>
<span id="cb4-81"><a href="csimd.html#cb4-81"></a>   <span class="ex">0x0000000000400804</span> <span class="op">&lt;</span>+<span class="op">429&gt;</span>:   mov    -0x18(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-82"><a href="csimd.html#cb4-82"></a>   <span class="ex">0x0000000000400808</span> <span class="op">&lt;</span>+<span class="op">433&gt;</span>:   lea    0x0(,%rax,8),<span class="ex">%rdx</span></span>
<span id="cb4-83"><a href="csimd.html#cb4-83"></a>   <span class="ex">0x0000000000400810</span> <span class="op">&lt;</span>+<span class="op">441&gt;</span>:   mov    -0x198(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-84"><a href="csimd.html#cb4-84"></a>   <span class="ex">0x0000000000400817</span> <span class="op">&lt;</span>+<span class="op">448&gt;</span>:   add    %rdx,%rax</span>
<span id="cb4-85"><a href="csimd.html#cb4-85"></a>   <span class="ex">0x000000000040081a</span> <span class="op">&lt;</span>+<span class="op">451&gt;</span>:   vmovsd (%rax),<span class="ex">%xmm1</span></span>
<span id="cb4-86"><a href="csimd.html#cb4-86"></a>   <span class="ex">0x000000000040081e</span> <span class="op">&lt;</span>+<span class="op">455&gt;</span>:   mov    -0x18(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-87"><a href="csimd.html#cb4-87"></a>   <span class="ex">0x0000000000400822</span> <span class="op">&lt;</span>+<span class="op">459&gt;</span>:   lea    0x0(,%rax,8),<span class="ex">%rdx</span></span>
<span id="cb4-88"><a href="csimd.html#cb4-88"></a>   <span class="ex">0x000000000040082a</span> <span class="op">&lt;</span>+<span class="op">467&gt;</span>:   mov    -0x1a0(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-89"><a href="csimd.html#cb4-89"></a>   <span class="ex">0x0000000000400831</span> <span class="op">&lt;</span>+<span class="op">474&gt;</span>:   add    %rdx,%rax</span>
<span id="cb4-90"><a href="csimd.html#cb4-90"></a>   <span class="ex">0x0000000000400834</span> <span class="op">&lt;</span>+<span class="op">477&gt;</span>:   vmovsd (%rax),<span class="ex">%xmm0</span></span>
<span id="cb4-91"><a href="csimd.html#cb4-91"></a>   <span class="ex">0x0000000000400838</span> <span class="op">&lt;</span>+<span class="op">481&gt;</span>:   vmulsd %xmm0,%xmm1,%xmm0</span>
<span id="cb4-92"><a href="csimd.html#cb4-92"></a>   <span class="ex">0x000000000040083c</span> <span class="op">&lt;</span>+<span class="op">485&gt;</span>:   mov    -0x18(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-93"><a href="csimd.html#cb4-93"></a>   <span class="ex">0x0000000000400840</span> <span class="op">&lt;</span>+<span class="op">489&gt;</span>:   lea    0x0(,%rax,8),<span class="ex">%rdx</span></span>
<span id="cb4-94"><a href="csimd.html#cb4-94"></a>   <span class="ex">0x0000000000400848</span> <span class="op">&lt;</span>+<span class="op">497&gt;</span>:   mov    -0x1a8(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-95"><a href="csimd.html#cb4-95"></a>   <span class="ex">0x000000000040084f</span> <span class="op">&lt;</span>+<span class="op">504&gt;</span>:   add    %rdx,%rax</span>
<span id="cb4-96"><a href="csimd.html#cb4-96"></a>   <span class="ex">0x0000000000400852</span> <span class="op">&lt;</span>+<span class="op">507&gt;</span>:   vmovsd (%rax),<span class="ex">%xmm1</span></span>
<span id="cb4-97"><a href="csimd.html#cb4-97"></a>   <span class="ex">0x0000000000400856</span> <span class="op">&lt;</span>+<span class="op">511&gt;</span>:   mov    -0x18(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-98"><a href="csimd.html#cb4-98"></a>   <span class="ex">0x000000000040085a</span> <span class="op">&lt;</span>+<span class="op">515&gt;</span>:   lea    0x0(,%rax,8),<span class="ex">%rdx</span></span>
<span id="cb4-99"><a href="csimd.html#cb4-99"></a>   <span class="ex">0x0000000000400862</span> <span class="op">&lt;</span>+<span class="op">523&gt;</span>:   mov    -0x1b0(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-100"><a href="csimd.html#cb4-100"></a>   <span class="ex">0x0000000000400869</span> <span class="op">&lt;</span>+<span class="op">530&gt;</span>:   add    %rdx,%rax</span>
<span id="cb4-101"><a href="csimd.html#cb4-101"></a>   <span class="ex">0x000000000040086c</span> <span class="op">&lt;</span>+<span class="op">533&gt;</span>:   vaddsd %xmm1,%xmm0,%xmm0</span>
<span id="cb4-102"><a href="csimd.html#cb4-102"></a>   <span class="ex">0x0000000000400870</span> <span class="op">&lt;</span>+<span class="op">537&gt;</span>:   vmovsd %xmm0,(%rax)</span>
<span id="cb4-103"><a href="csimd.html#cb4-103"></a>   <span class="ex">0x0000000000400874</span> <span class="op">&lt;</span>+<span class="op">541&gt;</span>:   addq   <span class="va">$0</span>x1,-0x18(%rbp)</span>
<span id="cb4-104"><a href="csimd.html#cb4-104"></a>   <span class="ex">0x0000000000400879</span> <span class="op">&lt;</span>+<span class="op">546&gt;</span>:   mov    -0x18(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-105"><a href="csimd.html#cb4-105"></a>   <span class="ex">0x000000000040087d</span> <span class="op">&lt;</span>+<span class="op">550&gt;</span>:   cmp    -0x1b8(%rbp),<span class="ex">%rax</span></span>
<span id="cb4-106"><a href="csimd.html#cb4-106"></a>   <span class="ex">0x0000000000400884</span> <span class="op">&lt;</span>+<span class="op">557&gt;</span>:   jb     0x400804 <span class="op">&lt;</span>muladd+<span class="op">429&gt;</span></span>
<span id="cb4-107"><a href="csimd.html#cb4-107"></a>   <span class="ex">0x000000000040088a</span> <span class="op">&lt;</span>+<span class="op">563&gt;</span>:   nop</span>
<span id="cb4-108"><a href="csimd.html#cb4-108"></a>   <span class="ex">0x000000000040088b</span> <span class="op">&lt;</span>+<span class="op">564&gt;</span>:   add    <span class="va">$0</span>x150,%rsp</span>
<span id="cb4-109"><a href="csimd.html#cb4-109"></a>   <span class="ex">0x0000000000400892</span> <span class="op">&lt;</span>+<span class="op">571&gt;</span>:   pop    %r10</span>
<span id="cb4-110"><a href="csimd.html#cb4-110"></a>   <span class="ex">0x0000000000400894</span> <span class="op">&lt;</span>+<span class="op">573&gt;</span>:   pop    %rbp</span>
<span id="cb4-111"><a href="csimd.html#cb4-111"></a>   <span class="ex">0x0000000000400895</span> <span class="op">&lt;</span>+<span class="op">574&gt;</span>:   lea    -0x8(%r10),<span class="ex">%rsp</span></span>
<span id="cb4-112"><a href="csimd.html#cb4-112"></a>   <span class="ex">0x0000000000400899</span> <span class="op">&lt;</span>+<span class="op">578&gt;</span>:   retq</span>
<span id="cb4-113"><a href="csimd.html#cb4-113"></a><span class="ex">End</span> of assembler dump.</span></code></pre></div>
<p>å¯¹æ¯”ä¸€ä¸‹æ ‡é‡ç‰ˆå¾—åˆ°çš„æ±‡ç¼–ï¼š</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="csimd.html#cb5-1"></a>$ <span class="fu">gdb</span> muladd</span>
<span id="cb5-2"><a href="csimd.html#cb5-2"></a>  <span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">disassemble</span> muladd</span>
<span id="cb5-3"><a href="csimd.html#cb5-3"></a>  <span class="ex">Dump</span> of assembler code for function muladd:</span>
<span id="cb5-4"><a href="csimd.html#cb5-4"></a>   <span class="ex">0x0000000000400637</span> <span class="op">&lt;</span>+<span class="op">0&gt;</span>:     push   %rbp</span>
<span id="cb5-5"><a href="csimd.html#cb5-5"></a>   <span class="ex">0x0000000000400638</span> <span class="op">&lt;</span>+<span class="op">1&gt;</span>:     mov    %rsp,%rbp</span>
<span id="cb5-6"><a href="csimd.html#cb5-6"></a>   <span class="ex">0x000000000040063b</span> <span class="op">&lt;</span>+<span class="op">4&gt;</span>:     mov    %rdi,-0x18(%rbp)</span>
<span id="cb5-7"><a href="csimd.html#cb5-7"></a>   <span class="ex">0x000000000040063f</span> <span class="op">&lt;</span>+<span class="op">8&gt;</span>:     mov    %rsi,-0x20(%rbp)</span>
<span id="cb5-8"><a href="csimd.html#cb5-8"></a>   <span class="ex">0x0000000000400643</span> <span class="op">&lt;</span>+<span class="op">12&gt;</span>:    mov    %rdx,-0x28(%rbp)</span>
<span id="cb5-9"><a href="csimd.html#cb5-9"></a>   <span class="ex">0x0000000000400647</span> <span class="op">&lt;</span>+<span class="op">16&gt;</span>:    mov    %rcx,-0x30(%rbp)</span>
<span id="cb5-10"><a href="csimd.html#cb5-10"></a>   <span class="ex">0x000000000040064b</span> <span class="op">&lt;</span>+<span class="op">20&gt;</span>:    mov    %r8,-0x38(%rbp)</span>
<span id="cb5-11"><a href="csimd.html#cb5-11"></a>   <span class="ex">0x000000000040064f</span> <span class="op">&lt;</span>+<span class="op">24&gt;</span>:    movq   <span class="va">$0</span>x0,-0x8(%rbp)</span>
<span id="cb5-12"><a href="csimd.html#cb5-12"></a>   <span class="ex">0x0000000000400657</span> <span class="op">&lt;</span>+<span class="op">32&gt;</span>:    jmp    0x4006c2 <span class="op">&lt;</span>muladd+<span class="op">139&gt;</span></span>
<span id="cb5-13"><a href="csimd.html#cb5-13"></a>   <span class="ex">0x0000000000400659</span> <span class="op">&lt;</span>+<span class="op">34&gt;</span>:    mov    -0x8(%rbp),<span class="ex">%rax</span></span>
<span id="cb5-14"><a href="csimd.html#cb5-14"></a>   <span class="ex">0x000000000040065d</span> <span class="op">&lt;</span>+<span class="op">38&gt;</span>:    lea    0x0(,%rax,8),<span class="ex">%rdx</span></span>
<span id="cb5-15"><a href="csimd.html#cb5-15"></a>   <span class="ex">0x0000000000400665</span> <span class="op">&lt;</span>+<span class="op">46&gt;</span>:    mov    -0x18(%rbp),<span class="ex">%rax</span></span>
<span id="cb5-16"><a href="csimd.html#cb5-16"></a>   <span class="ex">0x0000000000400669</span> <span class="op">&lt;</span>+<span class="op">50&gt;</span>:    add    %rdx,%rax</span>
<span id="cb5-17"><a href="csimd.html#cb5-17"></a>   <span class="ex">0x000000000040066c</span> <span class="op">&lt;</span>+<span class="op">53&gt;</span>:    movsd  (%rax),<span class="ex">%xmm1</span></span>
<span id="cb5-18"><a href="csimd.html#cb5-18"></a>   <span class="ex">0x0000000000400670</span> <span class="op">&lt;</span>+<span class="op">57&gt;</span>:    mov    -0x8(%rbp),<span class="ex">%rax</span></span>
<span id="cb5-19"><a href="csimd.html#cb5-19"></a>   <span class="ex">0x0000000000400674</span> <span class="op">&lt;</span>+<span class="op">61&gt;</span>:    lea    0x0(,%rax,8),<span class="ex">%rdx</span></span>
<span id="cb5-20"><a href="csimd.html#cb5-20"></a>   <span class="ex">0x000000000040067c</span> <span class="op">&lt;</span>+<span class="op">69&gt;</span>:    mov    -0x20(%rbp),<span class="ex">%rax</span></span>
<span id="cb5-21"><a href="csimd.html#cb5-21"></a>   <span class="ex">0x0000000000400680</span> <span class="op">&lt;</span>+<span class="op">73&gt;</span>:    add    %rdx,%rax</span>
<span id="cb5-22"><a href="csimd.html#cb5-22"></a>   <span class="ex">0x0000000000400683</span> <span class="op">&lt;</span>+<span class="op">76&gt;</span>:    movsd  (%rax),<span class="ex">%xmm0</span></span>
<span id="cb5-23"><a href="csimd.html#cb5-23"></a>   <span class="ex">0x0000000000400687</span> <span class="op">&lt;</span>+<span class="op">80&gt;</span>:    mulsd  %xmm1,%xmm0</span>
<span id="cb5-24"><a href="csimd.html#cb5-24"></a>   <span class="ex">0x000000000040068b</span> <span class="op">&lt;</span>+<span class="op">84&gt;</span>:    mov    -0x8(%rbp),<span class="ex">%rax</span></span>
<span id="cb5-25"><a href="csimd.html#cb5-25"></a>   <span class="ex">0x000000000040068f</span> <span class="op">&lt;</span>+<span class="op">88&gt;</span>:    lea    0x0(,%rax,8),<span class="ex">%rdx</span></span>
<span id="cb5-26"><a href="csimd.html#cb5-26"></a>   <span class="ex">0x0000000000400697</span> <span class="op">&lt;</span>+<span class="op">96&gt;</span>:    mov    -0x28(%rbp),<span class="ex">%rax</span></span>
<span id="cb5-27"><a href="csimd.html#cb5-27"></a>   <span class="ex">0x000000000040069b</span> <span class="op">&lt;</span>+<span class="op">100&gt;</span>:   add    %rdx,%rax</span>
<span id="cb5-28"><a href="csimd.html#cb5-28"></a>   <span class="ex">0x000000000040069e</span> <span class="op">&lt;</span>+<span class="op">103&gt;</span>:   movsd  (%rax),<span class="ex">%xmm1</span></span>
<span id="cb5-29"><a href="csimd.html#cb5-29"></a>   <span class="ex">0x00000000004006a2</span> <span class="op">&lt;</span>+<span class="op">107&gt;</span>:   mov    -0x8(%rbp),<span class="ex">%rax</span></span>
<span id="cb5-30"><a href="csimd.html#cb5-30"></a>   <span class="ex">0x00000000004006a6</span> <span class="op">&lt;</span>+<span class="op">111&gt;</span>:   lea    0x0(,%rax,8),<span class="ex">%rdx</span></span>
<span id="cb5-31"><a href="csimd.html#cb5-31"></a>   <span class="ex">0x00000000004006ae</span> <span class="op">&lt;</span>+<span class="op">119&gt;</span>:   mov    -0x30(%rbp),<span class="ex">%rax</span></span>
<span id="cb5-32"><a href="csimd.html#cb5-32"></a>   <span class="ex">0x00000000004006b2</span> <span class="op">&lt;</span>+<span class="op">123&gt;</span>:   add    %rdx,%rax</span>
<span id="cb5-33"><a href="csimd.html#cb5-33"></a>   <span class="ex">0x00000000004006b5</span> <span class="op">&lt;</span>+<span class="op">126&gt;</span>:   addsd  %xmm1,%xmm0</span>
<span id="cb5-34"><a href="csimd.html#cb5-34"></a>   <span class="ex">0x00000000004006b9</span> <span class="op">&lt;</span>+<span class="op">130&gt;</span>:   movsd  %xmm0,(%rax)</span>
<span id="cb5-35"><a href="csimd.html#cb5-35"></a>   <span class="ex">0x00000000004006bd</span> <span class="op">&lt;</span>+<span class="op">134&gt;</span>:   addq   <span class="va">$0</span>x1,-0x8(%rbp)</span>
<span id="cb5-36"><a href="csimd.html#cb5-36"></a>   <span class="ex">0x00000000004006c2</span> <span class="op">&lt;</span>+<span class="op">139&gt;</span>:   mov    -0x8(%rbp),<span class="ex">%rax</span></span>
<span id="cb5-37"><a href="csimd.html#cb5-37"></a>   <span class="ex">0x00000000004006c6</span> <span class="op">&lt;</span>+<span class="op">143&gt;</span>:   cmp    -0x38(%rbp),<span class="ex">%rax</span></span>
<span id="cb5-38"><a href="csimd.html#cb5-38"></a>   <span class="ex">0x00000000004006ca</span> <span class="op">&lt;</span>+<span class="op">147&gt;</span>:   jb     0x400659 <span class="op">&lt;</span>muladd+<span class="op">34&gt;</span></span>
<span id="cb5-39"><a href="csimd.html#cb5-39"></a>   <span class="ex">0x00000000004006cc</span> <span class="op">&lt;</span>+<span class="op">149&gt;</span>:   nop</span>
<span id="cb5-40"><a href="csimd.html#cb5-40"></a>   <span class="ex">0x00000000004006cd</span> <span class="op">&lt;</span>+<span class="op">150&gt;</span>:   pop    %rbp</span>
<span id="cb5-41"><a href="csimd.html#cb5-41"></a>   <span class="ex">0x00000000004006ce</span> <span class="op">&lt;</span>+<span class="op">151&gt;</span>:   retq</span>
<span id="cb5-42"><a href="csimd.html#cb5-42"></a><span class="ex">End</span> of assembler dump.</span></code></pre></div>
<p>å·®å¥½å¤šï¼ä»”ç»†çœ‹ä¸€ä¸‹ï¼ŒSIMDç‰ˆæœ¬ä¸­&lt;+89&gt;åˆ°&lt;+128&gt;è¿™éƒ¨åˆ†ã€‚ç®€å•è§£é‡Šä¸€ä¸‹ï¼š</p>
<table>
<thead>
<tr class="header">
<th><ä½ç½®></th>
<th>æ±‡ç¼–</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>&lt; +89&gt;</td>
<td>mov -0x18(%rbp),%rax</td>
<td>å°†å¾ªç¯å˜é‡(i) è¯»å…¥å¯„å­˜å™¨rax</td>
</tr>
<tr class="even">
<td>&lt; +93&gt;</td>
<td>shl $0x5,%rax</td>
<td>raxä¸­çš„æ•°å·¦ç§»5ä½(ç›¸å½“äº*32).</td>
</tr>
<tr class="odd">
<td>&lt; +97&gt;</td>
<td>mov %rax,%rdx</td>
<td>å°†raxä¸­çš„æ•°æ‹·è´åˆ°rdxå¯„å­˜å™¨ä¸­</td>
</tr>
<tr class="even">
<td>&lt;+100&gt;</td>
<td>mov -0x198(%rbp),%rax</td>
<td>å°†æ•°ç»„Açš„åœ°å€è¯»å…¥å¯„å­˜å™¨rax</td>
</tr>
<tr class="odd">
<td>&lt;+107&gt;</td>
<td>add %rdx,%rax</td>
<td>rax = rax + rdx</td>
</tr>
<tr class="even">
<td>&lt;+124&gt;</td>
<td>vmovapd (%rax),%ymm0</td>
<td>ä»raxå¯„å­˜å™¨æ‰€ç¤ºåœ°å€å¤„è¯»å–256ä½åˆ°YMM0</td>
</tr>
<tr class="odd">
<td>&lt;+128&gt;</td>
<td>vmovapd %ymm0,-0x50(%rbp)</td>
<td>å°†YMM0ä¸­çš„æ•°æ®ä¿å­˜åœ¨æ ˆä¸Šçš„ä¸€ä¸ªä½ç½®</td>
</tr>
</tbody>
</table>
<blockquote>
<p>å¦‚æœæ‚¨æ›¾ç»å­¦ä¹ è¿‡ã€Šæ±‡ç¼–è¯­è¨€ç¨‹åºè®¾è®¡ã€‹æˆ–è€…ã€Šå¾®æœºåŸç†ã€‹ç­‰è¯¾ç¨‹ï¼Œå¯èƒ½ä¼šå¯¹ä¸Šè¿°æ±‡ç¼–ä»£ç æœ‰ç–‘é—®ã€‚è¿™æ˜¯ç”±äºé€šå¸¸å¾®æœºåŸç†è¯¾ç¨‹ä½¿ç”¨çš„æ˜¯Intel æ ¼å¼çš„æ±‡ç¼–(ins dst, src)ï¼Œè€ŒGCCä½¿ç”¨AT&amp;Tæ ¼å¼(ins src, dst)ï¼Œä¸€èˆ¬æ¥è®²æ“ä½œæ•°çš„é¡ºåºå’ŒIntelæ ¼å¼éƒ½æ˜¯åè¿‡æ¥çš„ã€‚<br />
å¦‚æœæ‚¨å¹¶ä¸æ‡‚æ±‡ç¼–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥çœ‹ç»“è®ºã€‚å¦‚æœå¯¹æ±‡ç¼–æ„Ÿå…´è¶£ï¼Œå¯ä»¥å‚è€ƒé™„å½•ã€‚</p>
</blockquote>
<p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ¯ä¸€æ¬¡å¾ªç¯æŠŠéœ€è¦çš„å€¼å–åˆ°å¯„å­˜å™¨ä¸­ï¼Œå†å­˜åˆ°æ ˆä¸Š(å¯ä»¥ç†è§£ä¸ºå‡½æ•°è‡ªæœ‰çš„å†…å­˜)ã€‚ä¸‰ä¸ªæ•°æ®éƒ½å­˜å¥½åï¼Œå†æŠŠä»–ä»¬ä¾æ¬¡ä»æ ˆé‡Œå–åˆ°ä¸åŒçš„YMMå¯„å­˜å™¨é‡Œï¼Œåšæ±‚ç§¯å’Œæ±‚å’Œï¼Œå†å­˜åˆ°ç›¸åº”ä½ç½®ã€‚ï¼ˆè¿™åªæ˜¯å¤§è‡´è¿‡ç¨‹ï¼Œå®é™…çœ‹ä¸€çœ‹ï¼Œå®ƒå¹²çš„å‚»äº‹è¿˜ä¸å°‘ï¼‰ã€‚</p>
<p>ä»”ç»†æƒ³æƒ³ï¼Œå…¶å®ç¼–è¯‘å™¨è¿™ä¹ˆåšæ˜¯æœ‰é“ç†çš„ã€‚åœ¨ç¨‹åºé‡Œï¼Œæˆ‘ä»¬å†™äº†<code>__m256d ymma = _mm256_load_pd(a+i*4);</code>ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬è¦æœ‰ä¸€ä¸ª<code>ymma</code>å˜é‡ã€‚ç¼–è¯‘å™¨å¹¶ä¸çŸ¥é“æˆ‘ä»¬ä¼šä¸ä¼šå¯¹è¿™ä¸ªå˜é‡åš Â·ä¸€Â·äº›Â·å¥‡Â·æ€ªÂ·çš„Â·äº‹Â· å› æ­¤ä¾¿æŠŠå®ƒåˆå†™è¿›äº†æ ˆé‡Œã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•è®©ç¼–è¯‘å™¨æ˜ç™½æˆ‘ä»¬ä¸ä¼šä¹±åŠ¨<code>ymma</code>å‘¢ï¼Ÿæœ‰ï¼</p>
</div>
<div id="csimd_reg" class="section level2">
<h2><span class="header-section-number">1.3</span> æä¸ªå¯„å­˜å™¨å˜é‡</h2>
<blockquote>
<p><em>æˆ‘ä¹°å‡ ä¸ªæ©˜å­å»ã€‚ä½ å°±åœ¨æ­¤åœ°ï¼Œä¸è¦èµ°åŠ¨ã€‚â€”â€”ã€ŠèƒŒå½±ã€‹</em></p>
</blockquote>
<p>åªè¦åœ¨å£°æ˜å˜é‡çš„æ—¶å€™ï¼Œåœ¨ç±»å‹å‰é¢åŠ ä¸Š<code>register</code>å…³é”®å­—ï¼Œç¼–è¯‘å™¨å°±æ˜ç™½è¿™ä¸ªä¸œè¥¿åº”è¯¥å¸¸é©»åœ¨å¯„å­˜å™¨é‡Œé¢ï¼Œå°±ä¸ä¼šæ¥å›è¯»å†™å†…å­˜äº†ã€‚éœ€è¦æ³¨æ„<strong>ä¸èƒ½å¯¹å¯„å­˜å™¨å˜é‡å–åœ°å€ï¼</strong>é¡ºä¾¿ï¼Œè¿™ä¸ªæµ“çœ‰å¤§çœ¼çš„å¾ªç¯æ¬¡æ•°ä¹Ÿå¯ä»¥æ”¾åˆ°å¯„å­˜å™¨é‡Œé¢çš„æ ·å­ï¼ŒæŠŠè¿™äº›ä¸œè¥¿åŠ ä¸Š<code>register</code>å…³é”®å­—ï¼š</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb6-1"><a href="csimd.html#cb6-1"></a>    <span class="dt">register</span> <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> M = N&gt;&gt;<span class="dv">2</span>;</span>
<span id="cb6-2"><a href="csimd.html#cb6-2"></a>    <span class="cf">for</span>(i = <span class="dv">0</span>; i &lt; M; i++){</span>
<span id="cb6-3"><a href="csimd.html#cb6-3"></a>        <span class="dt">register</span> __m256d ymma = _mm256_load_pd(a+i*<span class="dv">4</span>);</span>
<span id="cb6-4"><a href="csimd.html#cb6-4"></a>        <span class="dt">register</span> __m256d ymmb = _mm256_load_pd(b+i*<span class="dv">4</span>);</span>
<span id="cb6-5"><a href="csimd.html#cb6-5"></a>        <span class="dt">register</span> __m256d ymmc = _mm256_load_pd(c+i*<span class="dv">4</span>);</span>
<span id="cb6-6"><a href="csimd.html#cb6-6"></a>        <span class="dt">register</span> __m256d ymmd = _mm256_mul_pd(ymma, ymmb);</span>
<span id="cb6-7"><a href="csimd.html#cb6-7"></a>        ymmd = _mm256_add_pd(ymmd, ymmc);</span>
<span id="cb6-8"><a href="csimd.html#cb6-8"></a>        _mm256_store_pd(d+i*<span class="dv">4</span>,ymmd);</span>
<span id="cb6-9"><a href="csimd.html#cb6-9"></a>    }</span></code></pre></div>
<p>å†æ¥è¿è¡Œä¸‹ã€‚<strong>åˆ«å¿˜äº†ç¼–è¯‘æ—¶åŠ -mavx</strong><br />
å¤§æ¦‚12ç§’å·¦å³ã€‚å·²ç»æ¯”æœ€åŸå§‹çš„ç‰ˆæœ¬å¿«äº†è¿‘ä¸€å€äº†!å››èˆäº”å…¥ä¸€ä¸ªäº¿å•Šï¼</p>
<blockquote>
<p>åœ¨æ–°æ ‡å‡†çš„c++ä¸­ï¼Œæ®è¯´registerå…³é”®å­—å·²ç»æ²¡æœ‰æ„ä¹‰äº†ï¼ŒåŠ äº†registerç¼–è¯‘å™¨ä¹Ÿä¸ä¸€å®šç”¨å¯„å­˜å™¨ï¼Œä¸åŠ ä¹Ÿä¸ä¸€å®šå°±ä¸ç”¨ã€‚ä½†æ˜¯åœ¨æˆ‘ç”¨c++æµ‹è¯•çš„æ—¶å€™ï¼Œå‘ç°è¿˜æ˜¯æœ‰ç”¨çš„ã€‚<br />
åœ¨g++é‡Œå¢åŠ <code>-std=c++11</code>æˆ–è€…<code>-std=c++14</code>éƒ½å¯ä»¥é¡ºåˆ©ç¼–è¯‘ï¼Œè¿è¡Œé€Ÿåº¦ä¸€è‡´ã€‚å¦‚æœåŠ <code>-std=c++17</code>åˆ™ä¼šæŠ¥å‡ ä¸ªwarningï¼Œè¯´æ˜¯æ–°æ ‡å‡†ä¸è®¸regesterï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šæ¯”ä¸åŠ registerå…³é”®å­—è¦å¿«ã€‚ï¼ˆå•Šå“ˆï¼Œä½ ä¸ªc++17ï¼Œå˜´ä¸Šè¯´ç€warningï¼Œèº«ä½“å€’æ˜¯å¾ˆè€å®å˜›ï¼ï¼‰</p>
</blockquote>
</div>
<div id="csimd_asm" class="section level2">
<h2><span class="header-section-number">1.4</span> æˆ‘æ¯”ç¼–è¯‘å™¨èªæ˜ç³»åˆ—</h2>
<blockquote>
<p><em>ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã‚‚ã€å¤©å›½ã¸ã„ã‘ã‚‹ã‹ãªã€‚â€”â€”ã€Lost Universeã€</em></p>
</blockquote>
<p>è¿˜èƒ½ä¸èƒ½å†å¿«ä¸€ç‚¹ï¼Ÿæˆ‘æƒ³è¦çš„å››å€æé€Ÿå‘¢ï¼Ÿ<br />
ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨cè¯­è¨€çš„å†…è”æ±‡ç¼–åšè¿™ä»¶äº‹ã€‚</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="csimd.html#cb7-1"></a>__attribute__ ((noinline))</span>
<span id="cb7-2"><a href="csimd.html#cb7-2"></a><span class="dt">void</span> muladd(<span class="dt">double</span>* a, <span class="dt">double</span>* b, <span class="dt">double</span>* c,</span>
<span id="cb7-3"><a href="csimd.html#cb7-3"></a>            <span class="dt">double</span>* d, <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> N){</span>
<span id="cb7-4"><a href="csimd.html#cb7-4"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> i;</span>
<span id="cb7-5"><a href="csimd.html#cb7-5"></a>    __asm__ __volatile__(</span>
<span id="cb7-6"><a href="csimd.html#cb7-6"></a>            <span class="st">&quot;movq %0, %%rax </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-7"><a href="csimd.html#cb7-7"></a>            <span class="st">&quot;movq %1, %%rbx </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-8"><a href="csimd.html#cb7-8"></a>            <span class="st">&quot;movq %2, %%rcx </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-9"><a href="csimd.html#cb7-9"></a>            <span class="st">&quot;movq %3, %%rdx </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-10"><a href="csimd.html#cb7-10"></a>            <span class="st">&quot;movq %4, %%r8  </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-11"><a href="csimd.html#cb7-11"></a>            <span class="st">&quot;shr  $2, %%r8  </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-12"><a href="csimd.html#cb7-12"></a>            <span class="st">&quot;movq $0, %%r9  </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-13"><a href="csimd.html#cb7-13"></a>            <span class="st">&quot;jmp  .check_%= </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-14"><a href="csimd.html#cb7-14"></a>            <span class="st">&quot;.loop_%=:         </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-15"><a href="csimd.html#cb7-15"></a>            <span class="st">&quot;shl $2, %%r9   </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-16"><a href="csimd.html#cb7-16"></a>            <span class="st">&quot;vmovupd (%%rax, %%r9, 8), %%ymm0 </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-17"><a href="csimd.html#cb7-17"></a>            <span class="st">&quot;vmovupd (%%rbx, %%r9, 8), %%ymm1 </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-18"><a href="csimd.html#cb7-18"></a>            <span class="st">&quot;vmovupd (%%rcx, %%r9, 8), %%ymm2 </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-19"><a href="csimd.html#cb7-19"></a>            <span class="st">&quot;vmulpd %%ymm0, %%ymm1, %%ymm3    </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-20"><a href="csimd.html#cb7-20"></a>            <span class="st">&quot;vaddpd %%ymm2, %%ymm3, %%ymm3    </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-21"><a href="csimd.html#cb7-21"></a>            <span class="st">&quot;vmovupd %%ymm3, (%%rdx, %%r9, 8) </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-22"><a href="csimd.html#cb7-22"></a>            <span class="st">&quot;shr $2, %%r9                  </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-23"><a href="csimd.html#cb7-23"></a>            <span class="st">&quot;add $1, %%r9                  </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-24"><a href="csimd.html#cb7-24"></a>            <span class="st">&quot;.check_%=:                    </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-25"><a href="csimd.html#cb7-25"></a>            <span class="st">&quot;cmpq %%r8, %%r9               </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-26"><a href="csimd.html#cb7-26"></a>            <span class="st">&quot;jl .loop_%=                   </span><span class="sc">\n\t</span><span class="st">&quot;</span></span>
<span id="cb7-27"><a href="csimd.html#cb7-27"></a>            :</span>
<span id="cb7-28"><a href="csimd.html#cb7-28"></a>            :<span class="st">&quot;m&quot;</span>(a), <span class="st">&quot;m&quot;</span>(b), <span class="st">&quot;m&quot;</span>(c), <span class="st">&quot;m&quot;</span>(d), <span class="st">&quot;m&quot;</span>(N)</span>
<span id="cb7-29"><a href="csimd.html#cb7-29"></a>            :<span class="st">&quot;%rax&quot;</span>, <span class="st">&quot;%rbx&quot;</span>, <span class="st">&quot;%rcx&quot;</span>, <span class="st">&quot;%rdx&quot;</span>, <span class="st">&quot;%r8&quot;</span>, <span class="st">&quot;%r9&quot;</span>,</span>
<span id="cb7-30"><a href="csimd.html#cb7-30"></a>             <span class="st">&quot;%ymm0&quot;</span>, <span class="st">&quot;%ymm1&quot;</span>, <span class="st">&quot;%ymm2&quot;</span>, <span class="st">&quot;%ymm3&quot;</span>, <span class="st">&quot;memory&quot;</span></span>
<span id="cb7-31"><a href="csimd.html#cb7-31"></a>            );</span>
<span id="cb7-32"><a href="csimd.html#cb7-32"></a>    <span class="cf">if</span>(N%<span class="dv">4</span>!=<span class="dv">0</span>){</span>
<span id="cb7-33"><a href="csimd.html#cb7-33"></a>        <span class="cf">for</span>(i = N-N%<span class="dv">4</span>; i&lt;N; i++){</span>
<span id="cb7-34"><a href="csimd.html#cb7-34"></a>            d[i] = a[i]*b[i]+c[i];</span>
<span id="cb7-35"><a href="csimd.html#cb7-35"></a>        }</span>
<span id="cb7-36"><a href="csimd.html#cb7-36"></a>    }</span>
<span id="cb7-37"><a href="csimd.html#cb7-37"></a>}</span></code></pre></div>
<blockquote>
<p>å…³äºå†…è”æ±‡ç¼–çš„ä»‹ç»ï¼Œè¯·å‚è§é™„å½•ã€‚è¿™é‡Œç”¨ä¸€æ®µæ±‡ç¼–ä»£æ›¿äº†å‰é¢çš„å¾ªç¯éƒ¨åˆ†ã€‚å½“Nä¸æ˜¯4çš„æ•´æ•°å€æ—¶ä½™ä¸‹çš„1-3ä¸ªè¿ç®—ä½¿ç”¨æ™®é€šcä»£ç ï¼Œå¹¶ä¸ä¼šå¯¹æ€§èƒ½äº§ç”Ÿå¤ªå¤§å½±å“ã€‚ä»¥åŠï¼Œè¿™æ¬¡ç¼–è¯‘ä¸éœ€è¦<code>-mavx</code>äº†ã€‚</p>
</blockquote>
<p>ç¼–è¯‘ï¼Œè¿è¡Œä¸€ä¸‹ã€‚ä¸åˆ°4sï¼è¾¾åˆ°äº†é¢„æœŸçš„é€Ÿåº¦ã€‚</p>
<p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æ‰¾ä¸€ä¸‹AVX512æŒ‡ä»¤æ€ä¹ˆå†™ï¼ˆå…¶å®è·ŸAVXæ˜¯åŸºæœ¬ä¸€æ ·çš„ï¼‰ï¼Œè·å¾—è¿›ä¸€æ­¥åŠ é€Ÿã€‚</p>
</div>
<div id="csimd_gccO3" class="section level2">
<h2><span class="header-section-number">1.5</span> ç¼–è¯‘å™¨æ¯”æˆ‘èªæ˜ç³»åˆ—</h2>
<blockquote>
<p><em>Doing nothing often leads to the very best something.â€”â€”Winnie-the-Pooh</em></p>
</blockquote>
<p>è™½ç„¶è¿™é‡Œæ‰‹å†™äº†æ±‡ç¼–ï¼Œä½†æ˜¯åœ¨ä¸€èˆ¬çš„ç¨‹åºé‡Œä¸å»ºè®®è¿™ä¹ˆåšï¼Œé™¤éæœ‰ä¿¡å¿ƒåšå¾—å¥½å¹¶ä¸”èƒ½åŠ é€Ÿã€‚</p>
<p>å®æµ‹ï¼Œ<code>gcc -mavx -O3 -o muladd muladd.c</code>ç¼–è¯‘å‡ºæ¥çš„ç¨‹åºä¸ä¸Šè¿°å†…è”æ±‡ç¼–çš„ç¨‹åºé€Ÿåº¦ç›¸å·®æ— å‡ ã€‚åœ¨<code>-O3</code>ä¼˜åŒ–ä¸‹gccæ˜¯æœ‰çŸ¢é‡åŒ–ä¼˜åŒ–çš„ï¼Œä¹Ÿæ˜¯æŠŠè¿ç®—ä¼˜åŒ–åˆ°äº†å››ä¸ªä¸€ç»„åŒæ—¶åšã€‚</p>
<p>åŒç†ï¼Œ<code>gcc -mavx512f -O3 -o muladd muladd.c</code>ä¼šè¿›è¡ŒAVX512çŸ¢é‡åŒ–ï¼Œå…«ä¸ªä¸€ç»„ï¼Œå†å¿«ä¸€å€ï¼ˆå¯èƒ½ä¸åˆ°ç‚¹ä¸€å€ï¼‰ã€‚</p>
<p>æ­¤å¤–ï¼Œä½¿ç”¨intrinsicçš„åŒæ—¶ï¼Œå¦‚æœæ‰“å¼€<code>-O2</code>ä¼˜åŒ–ï¼Œé€Ÿåº¦ä¹Ÿä¼šå¾ˆå¿«ï¼Œç”šè‡³æ¯”æ‰‹å†™æ±‡ç¼–å¿«é‚£ä¹ˆä¸€ç‚¹ã€‚çœ‹ä¸€ä¸‹åæ±‡ç¼–ï¼Œæ˜¯å°‘äº†ä¸€äº›å–æ•°åˆ°å¯„å­˜å™¨çš„æ“ä½œï¼ˆå¥½å§æˆ‘æ‰¿è®¤æˆ‘å­¦è‰ºä¸ç²¾ï¼‰ã€‚ä½†æ˜¯<code>-O2</code>ä¼˜åŒ–æœ¬èº«æ˜¯ä¸è¿›è¡ŒçŸ¢é‡åŒ–çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨<code>-O2</code>ä¼˜åŒ–ä¸‹å¦‚æœä½¿ç”¨æˆ‘ä»¬æœ€å¼€å§‹çš„<code>muladd.c</code>çš„è¯æ˜¯åˆ©ç”¨ä¸åˆ°SIMDæ¥åŠ é€Ÿçš„ã€‚å› æ­¤ç”¨<code>-O2</code>é…åˆintrinsicå¯èƒ½æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚</p>
<blockquote>
<p>é¡ºä¾¿æä¸€ä¸‹ï¼Œæ— è®ºæ˜¯æ±‡ç¼–è¿˜æ˜¯intrinsicï¼Œå¯è¯»æ€§éƒ½æ¯”è¾ƒå·®ï¼Œæœ€å¥½å¤šåŠ ä¸€äº›æ³¨é‡Šã€‚</p>
</blockquote>
</div>
<div id="csimd_sum" class="section level2">
<h2><span class="header-section-number">1.6</span> æœ¬ç« å°ç»“</h2>
<p>SIMDå¤§æ¦‚æ˜¯ç²’åº¦æœ€å°çš„å¹¶è¡Œäº†å§ï¼Ÿå¦‚åŒä¸Šé¢çš„ä¾‹å­ï¼Œé€‚å½“ä½¿ç”¨å·²ç»å¯ä»¥æå¤§åœ°æé«˜ç¨‹åºè¿è¡Œé€Ÿåº¦äº†ã€‚</p>
<p>è¦æ³¨æ„ä¸€ç‚¹ï¼Œè¿™é‡Œé¢â€œçŸ¢é‡è¿ç®—â€åªæ˜¯åŒæ—¶åšå¥½å‡ ä¸ªè¿ç®—åœ°æ„æ€ï¼Œå¦‚æœä½ æƒ³çœŸçš„æŠŠå®ƒå½“ä½œçŸ¢é‡ï¼Œç”šè‡³æƒ³æ±‚ä¸ªå¤–ç§¯ï¼Œé‚£å°±è¶…å‡ºå¤„ç†å™¨çš„èƒ½åŠ›èŒƒå›´äº†ã€‚åªèƒ½æŠŠå¤–ç§¯è¿ç®—åˆ†è§£æˆåŠ å‡ä¹˜é™¤å†è¿›è¡Œè®¡ç®—ã€‚</p>
<p>è¿™ä¸€ç« åˆ°è¿™é‡Œå°±åº”è¯¥ç»“æŸäº†ï¼Œä½†æˆ‘è§‰å¾—é˜…è¯»æŒ‡å—çš„ä½ è„‘ä¸­ä¸€å®šå……æ»¡äº†é—®å·ã€‚æ‰€ä»¥åœ¨è¿™é‡Œå°è¯•è‡ªé—®è‡ªç­”ä¸€ä¸‹ã€‚</p>
<hr />
<p><strong>é—®ï¼šä¸ºä»€ä¹ˆè¦åš1,000,000æ¬¡8192ç»´æ•°ç»„çš„è¿ç®—ï¼Œè€Œä¸ç›´æ¥ç”¨8,192,000,000ç»´çš„æ•°ç»„ï¼Ÿ</strong></p>
<p>ç­”ï¼šæ˜¯çš„ã€‚åœ¨æˆ‘åˆ¶ä½œè¿™ä»½æŒ‡å—ä¹‹å‰ä¹Ÿæ˜¯è¿™ä¹ˆæƒ³çš„ã€‚ä½†æ˜¯å‘ç°SIMDä»¥åé€Ÿåº¦å¹¶æ²¡æœ‰æé«˜ã€‚ç»æŸ¥ï¼Œå‘ç°åŸç†åœ¨äºå†…å­˜å¸¦å®½åƒæ»¡äº†ã€‚è™½ç„¶å¤„ç†å™¨å¯ä»¥ç®—å¾—é£å¿«ï¼Œä½†æ˜¯å†…å­˜é€Ÿåº¦è·Ÿä¸ä¸Šå¯¼è‡´é€Ÿåº¦è¢«é™åˆ¶äº†ï¼Œå› æ­¤çŸ¢é‡ç®—æ³•å’Œæ ‡é‡ç®—æ³•é€Ÿåº¦ç›¸è¿‘ã€‚è€Œå‡å°æ•°æ®è§„æ¨¡ä»¥åï¼Œ8192ä¸ªdoubleéƒ½ä¼šå­˜å‚¨åœ¨CPUçš„é«˜é€Ÿç¼“å­˜ä¸­ï¼Œè¿™æ ·å°±é¿å…äº†å†…å­˜å¸¦å®½çš„é™åˆ¶ï¼Œä»è€Œå¯ä»¥æ¯”è¾ƒå‘é‡å’Œæ ‡é‡æŒ‡ä»¤çš„é€Ÿåº¦å·®å¼‚ã€‚<br />
åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå¯¹æ•°æ®çš„å¤„ç†æ˜¾ç„¶ä¸åªæ˜¯å…ˆæ±‚ç§¯å†æ±‚å’Œè¿™ç§ç®€å•è¿ç®—ã€‚éšç€è¿ç®—å˜å¾—å¤æ‚ï¼Œå½“å¤„ç†æ•°æ®çš„æ—¶é—´è¾¾åˆ°ç”šè‡³è¶…è¿‡å†…å­˜å­˜å–ç”¨æ—¶çš„æ—¶å€™ï¼ŒSIMDçš„æé€Ÿæ•ˆæœè‡ªç„¶å°±å¯ä»¥ä½“ç°å‡ºæ¥äº†ã€‚</p>
<p>æ­¤å¤–ï¼Œ<span class="math inline">\(8,192,000,000 double \times 8 Byte/double = 65536 \times 10^{6} Byte \approx 64GB\)</span>åƒå†…å­˜ç¨å¾®æœ‰ç‚¹å¤§ã€‚</p>
<hr />
<p><strong>é—®ï¼šæ—¢ç„¶gccå¯ä»¥ä¼˜åŒ–å¾—è¿™ä¹ˆå¥½ï¼Œæè¿™ä¹ˆå¤æ‚å°±æ²¡æœ‰æ„ä¹‰äº†å§ï¼Ÿ</strong></p>
<p>ç­”ï¼šè¿™å¯ä¸å¥½è¯´äº†ã€‚åœ¨å¾ˆä¹…ä»¥å‰ï¼Œå¬è¯´gccçš„-O3æœ‰å¯èƒ½ä¼šæå‡ºè«åå…¶å¦™çš„bugã€‚è™½ç„¶æˆ‘æ²¡é‡åˆ°è¿‡è¿™ç§æƒ…å†µï¼Œè™½ç„¶è¿™ç§æƒ…å†µè‚¯å®šéå¸¸å°‘è§ï¼Œä½†æ˜¯æ€»çš„æ¥è¯´ç»™äººä¸€ç§ä¸å¤ªå¯é çš„æ„Ÿè§‰ã€‚æ­¤å¤–ï¼Œçº¯å‡­ä¸ªäººæ„Ÿè§‰ï¼Œå¯èƒ½gccçš„ä¼˜åŒ–åŠ›é‡ä¹Ÿæ˜¯æœ‰é™çš„ï¼Œå¦‚æœè®¡ç®—è¿‡ç¨‹æ¯”è¾ƒé•¿æ¯”è¾ƒå¤æ‚ï¼Œå¯èƒ½gccå¹¶ä¸ä¸€å®šèƒ½é€‰å‡ºæœ€åˆé€‚çš„ä¼˜åŒ–æ–¹æ³•ï¼ˆå¯èƒ½ä¼šæ‰¾ä¸åˆ°æ•°æ®/å˜é‡ä¹‹é—´çš„å…³è”ï¼Ÿï¼‰ã€‚è¿˜æœ‰ï¼Œå¦‚æœä½ çš„ç¨‹åºä¸ä½¿ç”¨C/C++çš„è¯ï¼Œè¿˜æœ‰ä¸€å®šçš„å¯èƒ½ä½ çš„ç¼–è¯‘å™¨å¹¶ä¸æ”¯æŒAVXï¼Œè¿™æ—¶å°±è¦è‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ç”¨C/C++æä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼‰ã€‚å¦å¤–<code>-O2</code>ä¸ä¼šè‡ªåŠ¨è¿›è¡ŒçŸ¢é‡åŒ–ï¼Œæ‰€ä»¥è‡³å°‘intrinsicåœ¨<code>-O2</code>ä¸‹è¿˜æ˜¯æœ‰æ„ä¹‰çš„ã€‚ä¸å¼€ä¼˜åŒ–å¼€å…³çš„è¯ï¼Œè¿˜æ˜¯è¦æ±‡ç¼–æ‰å¿«ä¸€äº›ã€‚å…·ä½“æ€ä¹ˆå†™ä»£ç ç”¨ä»€ä¹ˆä¼˜åŒ–è¿˜æ˜¯è¦è‡ªå·±å–èˆã€‚</p>
<hr />
<p><strong>é—®ï¼šä½œè€…ä½ å¥½å‰å®³å“¦ï¼å’‹å•¥éƒ½æ‡‚ï¼Ÿ</strong></p>
<p>ç­”ï¼šæ­£å¸¸å°æœ‹å‹ä¸€èˆ¬é—®ä¸å‡ºæ¥è¿™ç§é—®é¢˜ã€‚</p>
</div>
<div id="csimd_add" class="section level2">
<h2><span class="header-section-number">1.7</span> è¡¥å……å†…å®¹</h2>
<p>åœ¨è¿™é‡Œè¡¥å……ä¸€äº›æ¯”è¾ƒå¸¸ç”¨(å¤§æ¦‚)çš„AVXæŒ‡ä»¤å’Œå¯¹åº”çš„Intrinsicã€‚ï¼ˆæŒ‡ä»¤éƒ½æ˜¯AT&amp;Tæ ¼å¼ï¼‰</p>
<table>
<colgroup>
<col width="28%" />
<col width="28%" />
<col width="42%" />
</colgroup>
<thead>
<tr class="header">
<th>Intrinsic</th>
<th>æŒ‡ä»¤</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>_mm256_loadu_pd</td>
<td>VMOVUPD m256, ymm</td>
<td>å°†å†…å­˜ä¸­è¿ç»­çš„4ä¸ªdoubleè¯»å…¥ymm</td>
</tr>
<tr class="even">
<td>_mm256_storeu_pd</td>
<td>VMOVUPD ymm, m256</td>
<td>å°†ymmå¯„å­˜å™¨ä¸­çš„4ä¸ªdoubleå†™å…¥è¿ç»­å†…å­˜</td>
</tr>
<tr class="odd">
<td>_mm256_add_pd</td>
<td>VADDPD ymm1, ymm2, ymm3</td>
<td>ymm3 = ymm2 + ymm1</td>
</tr>
<tr class="even">
<td>_mm256_sub_pd</td>
<td>VSUBPD ymm1, ymm2, ymm3</td>
<td>ymm3 = ymm2 - ymm1</td>
</tr>
<tr class="odd">
<td>_mm256_mul_pd</td>
<td>VMULPD ymm1, ymm2, ymm3</td>
<td>ymm3 = ymm2 * ymm1</td>
</tr>
<tr class="even">
<td>_mm256_div_pd</td>
<td>VDIVPD ymm1, ymm2, ymm3</td>
<td>ymm3 = ymm2 / ymm1</td>
</tr>
<tr class="odd">
<td>_mm256_permute4x64_pd</td>
<td>VPERMPD imm8, ymm1, ymm2</td>
<td>ymm1æŒ‰ç…§imm8æ‰€è¿°é‡æ’å…¥ymm2</td>
</tr>
</tbody>
</table>
<p>è§£é‡Šä¸€ä¸‹é™¤æ³•å’Œå‡æ³•åè¿‡æ¥çš„é—®é¢˜ã€‚å‰é¢æåˆ°AT&amp;Tæ±‡ç¼–å’ŒIntelæ±‡ç¼–æ˜¯åå‘çš„ã€‚åœ¨MOVä¹‹ç±»çš„æŒ‡ä»¤ä¸­ï¼ŒAT&amp;Tæ ¼å¼çœ‹èµ·æ¥å’Œè°ä¸€ç‚¹ï¼Œç»“æœå°±æ˜¯åœ¨å‡æ³•å’Œé™¤æ³•çš„åœ°æ–¹åè¿‡æ¥äº†ã€‚</p>
<p>å…³äºpermuteï¼Œimm8æ˜¯ä¸€ä¸ªç«‹å³æ•°ï¼Œæ¯ä¸¤ä½ä¸ºä¸€ç»„ï¼Œè¡¨ç¤ºymmä¸­çš„ç¬¬æŸä¸ªæ•°ã€‚</p>
<blockquote>
<p>ä¾‹ï¼š<br />
ymm1 = (a, b, c, d)<br />
VPEMPD $0xc5, ymm1, ymm2<br />
=&gt; ymm2 = (b, b, a, d)</p>
</blockquote>
<p>æ˜¯è¿™æ ·çš„ï¼Œ0xc5 = 11 00 01 01 (b). 00å¯¹åº”aï¼Œ01å¯¹åº”bï¼Œ10å¯¹åº”cï¼Œ11å¯¹åº”dã€‚
è€Œä»MSBåˆ°LSBçš„é¡ºåºæ˜¯(3,2,1,0)çš„é¡ºåºã€‚å› æ­¤ç›®æ ‡çš„ç¬¬0ä¸ªdoubleæ˜¯æ ¹æ®æœ€ä½ä¸¤ä½01å–æ•°æ®ï¼Œå–åˆ°bï¼› ç¬¬ä¸€ä¸ªåŒç†ï¼Œ01-&gt;bï¼›ç¬¬äºŒä¸ªæ˜¯00ï¼Œå–aï¼›ç¬¬ä¸‰ä¸ªæ˜¯11ï¼Œå–dã€‚å¦å¤–ï¼Œå¦‚æœå†…å­˜é‡Œè¿ç»­çš„doubleæ˜¯(a,b,c,d)çš„è¯ï¼ŒVMOVUPDå–è¿›ymmå¯„å­˜å™¨çš„å€¼å°±æ˜¯(a,b,c,d).å¦‚æœå‚è€ƒä¸€äº›æ±‡ç¼–æ‰‹å†Œï¼Œå¯èƒ½ä¼šå‘ç°æ‰‹å†Œé‡Œå†™çš„æ˜¯åè¿‡æ¥çš„(d,c,b,a).è¿™åªæ˜¯è¡¨ç¤ºæ–¹æ³•ä¸åŒã€‚åœ¨æ±‡ç¼–æ‰‹å†Œé‡Œä¹ æƒ¯æŒ‰ç…§ä½ä½åœ¨å³é«˜ä½åœ¨å·¦çš„é¡ºåºè¡¨ç¤ºã€‚</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="part1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cmt.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yihui/bookdown-chinese/edit/master/02-c_para.Rmd",
"text": "ç¼–è¾‘"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown.pdf", "bookdown.epub"],
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
